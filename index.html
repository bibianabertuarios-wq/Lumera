<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumera - Your Wellness Companion</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Lato', sans-serif; }
        h1, h2, h3 { font-family: 'Playfair Display', serif; }
        .gradient-text { background: linear-gradient(135deg, #9333ea 0%, #ec4899 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // SUPABASE ACTIVADO
        const SUPABASE_URL = 'https://pyekwpmbdnmglrjieexc.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB5ZWt3cG1iZG5tZ2xyamllZXhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0ODM0OTgsImV4cCI6MjA4MTA1OTQ5OH0.zQl7GF3E6BhDqW3bEMixAbdDcOsW8BsFOBeAGa-5bzY';
        const BACKEND_URL = 'https://lumera-backend-production.up.railway.app';
        const STRIPE_KEY = 'pk_test_51Sejh162SZ6DF12OogSOE67ngoK4aE2C2xRW0pMJcfwWxaQq1UJ7SxzrOzrPfqnHdk1aa5VLyu91fFDBdKnFln6b00BS7k0uvU';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);        
        const stripe = window.Stripe(STRIPE_KEY);
        const PRICES = {
            latam: { id: 'price_1Sejoa62SZ6DF12Ox5sU1Y9v', price: '$4.99' },
            emea: { id: 'price_1Sejso62SZ6DF12O5eSsNiGQ', price: '€4.99' },
            usa: { id: 'price_1Sejuh62SZ6DF12OUR0k19Rd', price: '$6.99' }
        };

        const LumeraApp = () => {
            const [language, setLanguage] = useState('es');
            const [darkMode, setDarkMode] = useState(false);
            const [session, setSession] = useState(null);
            const [authMode, setAuthMode] = useState('login');
            const [authData, setAuthData] = useState({ email: '', password: '' });
            const [showAuth, setShowAuth] = useState(true); // FORZAR TRUE AL INICIO
            const [loading, setLoading] = useState(true);
            const [currentUser, setCurrentUser] = useState(null);
            const [currentPage, setCurrentPage] = useState('home');
            const [showQuiz, setShowQuiz] = useState(false);
            const [quizStep, setQuizStep] = useState(1);
            const [symptoms, setSymptoms] = useState([]);
            const [periodLog, setPeriodLog] = useState([]);
            const [userMessages, setUserMessages] = useState([]);
            const [exerciseGoal, setExerciseGoal] = useState('hormonal');
            const [userRegion, setUserRegion] = useState('LATAM');
            const [showTutorial, setShowTutorial] = useState(false);
            const [editingProfile, setEditingProfile] = useState(false);
            const [profileEdits, setProfileEdits] = useState({});
            const [showBmiInfo, setShowBmiInfo] = useState(false);
            const [showBmrInfo, setShowBmrInfo] = useState(false);
            const [showTdeeInfo, setShowTdeeInfo] = useState(false);
            
            // CHAT LUMI
            const [showLumiChat, setShowLumiChat] = useState(false);
            const [lumiMessages, setLumiMessages] = useState([]);
            const [lumiInput, setLumiInput] = useState('');
            const [lumiLoading, setLumiLoading] = useState(false);
            const [dailyQuestions, setDailyQuestions] = useState(0);
            const [lastQuestionDate, setLastQuestionDate] = useState(null);
            
            const [formData, setFormData] = useState({
                profileName: '',
                age: '',
                height: '',
                weight: '',
                conditions: [],
            });

            const [symptomForm, setSymptomForm] = useState({
                sleep: 5,
                energy: 5,
                mood: 5,
                hotFlashes: 0,
                anxiety: 5,
                date: new Date().toISOString().split('T')[0]
            });

            const [periodForm, setPeriodForm] = useState({
                intensity: 5,
                duration: 5,
                symptoms: '',
                date: new Date().toISOString().split('T')[0]
            });

            const [communityMessage, setCommunityMessage] = useState('');

            // REFS PARA GRÁFICOS
            const chartRefSleep = useRef(null);
            const chartRefEnergy = useRef(null);
            const chartRefMood = useRef(null);
            const chartRefHotFlashes = useRef(null);
            const chartRefPeriod = useRef(null);

            const chartsRef = useRef({
                sleep: null,
                energy: null,
                mood: null,
                hotFlashes: null,
                period: null
            });

            const t = {
                es: {
                    app_name: 'Lumera',
                    home: 'Inicio',
                    nutrition: 'Nutrición',
                    exercise: 'Ejercicio',
                    symptoms: 'Síntomas',
                    period: 'Período',
                    myths: 'Mitos',
                    tips: 'Consejos',
                    workshops: 'Talleres',
                    community: 'Comunidad',
                    save: 'Guardar',
                    cancel: 'Cancelar',
                    next: 'Siguiente',
                    exit: 'Salir',
                    ingredients: 'Ingredientes',
                    preparation: 'Preparación',
                    why: 'Por qué',
                    benefits: 'Beneficios',
                    day: 'Día',
                    breakfast: 'Desayuno',
                    lunch: 'Almuerzo',
                    dinner: 'Cena',
                    snack: 'Snack',
                    personalized: 'Personalizado para ti',
                    download: 'Descargar',
                    addRecord: 'Registrar',
                    strength: 'Ganar Fuerza',
                    weightLoss: 'Perder Peso',
                    hormonal: 'Equilibrio Hormonal'
                },
                en: {
                    app_name: 'Lumera',
                    home: 'Home',
                    nutrition: 'Nutrition',
                    exercise: 'Exercise',
                    symptoms: 'Symptoms',
                    period: 'Period',
                    myths: 'Myths',
                    tips: 'Tips',
                    workshops: 'Workshops',
                    community: 'Community',
                    save: 'Save',
                    cancel: 'Cancel',
                    next: 'Next',
                    exit: 'Exit',
                    ingredients: 'Ingredients',
                    preparation: 'Preparation',
                    why: 'Why',
                    benefits: 'Benefits',
                    day: 'Day',
                    breakfast: 'Breakfast',
                    lunch: 'Lunch',
                    dinner: 'Dinner',
                    snack: 'Snack',
                    personalized: 'Personalized for you',
                    download: 'Download',
                    addRecord: 'Record',
                    strength: 'Build Strength',
                    weightLoss: 'Lose Weight',
                    hormonal: 'Hormonal Balance'
                }
            };

            // CARGAR DATOS
            useEffect(() => {
                // CARGAR SESIÓN DESDE SUPABASE
                const checkSession = async () => {
                    const { data: { session } } = await supabase.auth.getSession();
                    
                    if (session) {
                        // Cargar perfil del usuario
                        const { data: profile } = await supabase
                            .from('users')
                            .select('*')
                            .eq('id', session.user.id)
                            .single();
                        
                        setSession(session);
                        setCurrentUser(profile || { id: session.user.id, email: session.user.email });
                        setShowAuth(false);
                        
                        // Si no tiene perfil completo, mostrar quiz
                        if (!profile?.profile_name) {
                            setShowQuiz(true);
                        }
                        
                        console.log('✅ Sesión cargada desde Supabase');
                    } else {
                        setShowAuth(true);
                        setShowQuiz(false);
                    }
                    
                    setLoading(false);
                };
                
                checkSession();
                
                // Listener para cambios de auth
                const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {
                    if (event === 'SIGNED_OUT') {
                        setSession(null);
                        setCurrentUser(null);
                        setShowAuth(true);
                    }
                });
                
                return () => subscription.unsubscribe();
            }, []);

            // GUARDAR PREFERENCIAS LOCALMENTE
            useEffect(() => {
                localStorage.setItem('lumeraDark', JSON.stringify(darkMode));
                localStorage.setItem('lumeraLang', language);
                localStorage.setItem('lumeraSymptoms', JSON.stringify(symptoms));
                localStorage.setItem('lumeraPeriod', JSON.stringify(periodLog));
                localStorage.setItem('lumeraMessages', JSON.stringify(userMessages));
            }, [darkMode, language, symptoms, periodLog, userMessages]);

            // GRÁFICOS DE SÍNTOMAS
            useEffect(() => {
                if (symptoms.length === 0) return;

                const labels = symptoms.map(s => s.date).slice(-14);
                const sleepData = symptoms.map(s => s.sleep).slice(-14);
                const energyData = symptoms.map(s => s.energy).slice(-14);
                const moodData = symptoms.map(s => s.mood).slice(-14);
                const hotFlashesData = symptoms.map(s => s.hotFlashes).slice(-14);

                const chartOptions = {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: true } },
                    scales: { y: { beginAtZero: true, max: 10 } }
                };

                setTimeout(() => {
                    if (chartRefSleep.current && window.Chart) {
                        if (chartsRef.current.sleep) chartsRef.current.sleep.destroy();
                        chartsRef.current.sleep = new window.Chart(chartRefSleep.current, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [{ label: language === 'es' ? 'Sueño' : 'Sleep', data: sleepData, borderColor: '#9333ea', backgroundColor: 'rgba(147,51,234,0.1)', borderWidth: 2, fill: true, tension: 0.4 }]
                            },
                            options: chartOptions
                        });
                    }

                    if (chartRefEnergy.current && window.Chart) {
                        if (chartsRef.current.energy) chartsRef.current.energy.destroy();
                        chartsRef.current.energy = new window.Chart(chartRefEnergy.current, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [{ label: language === 'es' ? 'Energía' : 'Energy', data: energyData, borderColor: '#ec4899', backgroundColor: 'rgba(236,72,153,0.1)', borderWidth: 2, fill: true, tension: 0.4 }]
                            },
                            options: chartOptions
                        });
                    }

                    if (chartRefMood.current && window.Chart) {
                        if (chartsRef.current.mood) chartsRef.current.mood.destroy();
                        chartsRef.current.mood = new window.Chart(chartRefMood.current, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [{ label: language === 'es' ? 'Ánimo' : 'Mood', data: moodData, borderColor: '#06b6d4', backgroundColor: 'rgba(6,182,212,0.1)', borderWidth: 2, fill: true, tension: 0.4 }]
                            },
                            options: chartOptions
                        });
                    }

                    if (chartRefHotFlashes.current && window.Chart) {
                        if (chartsRef.current.hotFlashes) chartsRef.current.hotFlashes.destroy();
                        chartsRef.current.hotFlashes = new window.Chart(chartRefHotFlashes.current, {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: [{ label: language === 'es' ? 'Sofocos' : 'Hot Flashes', data: hotFlashesData, backgroundColor: '#f97316', borderColor: '#ea580c', borderWidth: 1 }]
                            },
                            options: chartOptions
                        });
                    }
                }, 100);
            }, [symptoms, language]);

            // GRÁFICOS DE PERÍODO
            useEffect(() => {
                if (periodLog.length === 0) return;

                const labels = periodLog.map(p => p.date).slice(-12);
                const intensityData = periodLog.map(p => p.intensity).slice(-12);
                const durationData = periodLog.map(p => p.duration).slice(-12);

                const chartOptions = {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: true } },
                    scales: { y: { beginAtZero: true } }
                };

                setTimeout(() => {
                    if (chartRefPeriod.current && window.Chart) {
                        if (chartsRef.current.period) chartsRef.current.period.destroy();
                        chartsRef.current.period = new window.Chart(chartRefPeriod.current, {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: [
                                    { label: language === 'es' ? 'Intensidad' : 'Intensity', data: intensityData, backgroundColor: '#ec4899', borderColor: '#be185d', borderWidth: 1 },
                                    { label: language === 'es' ? 'Duración (días)' : 'Duration (days)', data: durationData, backgroundColor: '#f97316', borderColor: '#c2410c', borderWidth: 1 }
                                ]
                            },
                            options: chartOptions
                        });
                    }
                }, 100);
            }, [periodLog, language]);

            // MENÚS 7 DÍAS
            const getWeekMenus = () => {
                // MENÚS BASE (simplificados para demo)
                const baseMenus = {
                    es: {
                        lunes: [
                            { 
                                name: 'Bowl de Avena que Te Cuida', 
                                meal: 'Desayuno',
                                horario: '7:00-9:00 AM',
                                whyHorario: 'Tu cortisol está alto naturalmente al despertar. Carbohidratos complejos en este momento estabilizan tu energía para todo el día sin picos de insulina.',
                                calories: 420, 
                                time: '12 min', 
                                ingredients: [
                                    { name: 'Avena integral', qty: 50, unit: 'g', why: 'Te mantendrá llena hasta el almuerzo sin picos de azúcar que te dejen sin energía a media mañana.', region: { latam: 'Avena', emea: 'Avena', usa: 'Oats' }, eco: 'Cualquier marca', gourmet: 'Avena orgánica' }, 
                                    { name: 'Leche fortificada', qty: 200, unit: 'ml', why: 'Tus huesos necesitan calcio extra ahora. Esta leche te da justo lo que piden.', region: { latam: 'Leche', emea: 'Leche', usa: 'Milk' }, eco: 'Leche de vaca', gourmet: 'Leche de almendras fortificada' }, 
                                    { name: 'Semillas de chía', qty: 15, unit: 'g', why: 'Tienen un tipo de grasa que ayuda a calmar los sofocos. Muchas mujeres notan la diferencia en días.', region: { latam: 'Chía', emea: 'Semillas de chía', usa: 'Chia seeds' }, eco: 'Semillas de lino molidas', gourmet: 'Chía orgánica' },
                                    { name: 'Frutos rojos', qty: 80, unit: 'g', why: 'Protegen tu cerebro cuando sientes esa niebla mental. Son como un escudo para tu claridad.', region: { latam: 'Frutillas o moras', emea: 'Arándanos', usa: 'Blueberries' }, eco: 'Congelados (mismos nutrientes)', gourmet: 'Frescos orgánicos' },
                                    { name: 'Frutos secos', qty: 10, unit: 'g', why: 'Te ayudan a dormir mejor por la noche. Tienen algo que tu cuerpo convierte en calma.', region: { latam: 'Maní o nueces', emea: 'Almendras', usa: 'Almonds or walnuts' }, eco: 'Cacahuetes', gourmet: 'Almendras crudas' }
                                ], 
                                steps: ['Calienta la leche 2 minutos', 'Echa la avena y remueve mientras cocina 8 minutos', 'Añade las semillas los últimos 2 minutos', 'Sirve y decora con los frutos rojos y los frutos secos por encima'], 
                                why: 'Este desayuno te da energía constante toda la mañana. El magnesio de las semillas te ayudará con los sofocos, y las grasas buenas calman la inflamación que sientes en las articulaciones.'
                            },
                            { 
                                name: 'Pescado con Todo lo que Necesitas', 
                                meal: 'Almuerzo',
                                horario: '12:00-2:00 PM', 
                                whyHorario: 'Tu digestión está en su pico. Proteína y grasas buenas ahora se absorben mejor y mantienen tu energía estable toda la tarde.',
                                calories: 540, 
                                time: '25 min', 
                                ingredients: [
                                    { name: 'Pescado graso', qty: 150, unit: 'g', why: 'Este pescado tiene las grasas que tu cuerpo dejó de producir. Calman dolores y te dan claridad mental.', region: { latam: 'Jurel o atún', emea: 'Sardinas o caballa', usa: 'Salmon or sardines' }, eco: 'Sardinas en lata (mismos beneficios)', gourmet: 'Salmón fresco' }, 
                                    { name: 'Quinoa o arroz', qty: 120, unit: 'g', why: 'Proteína completa que mantiene tus músculos fuertes. Ahora los pierdes más rápido y esto lo frena.', region: { latam: 'Quinoa (barata allí)', emea: 'Quinoa', usa: 'Quinoa' }, eco: 'Arroz integral', gourmet: 'Quinoa tricolor' },
                                    { name: 'Espinacas', qty: 100, unit: 'g', why: 'Hierro para cuando tus reglas se vuelven locas. Y vitamina K para tus huesos.', region: { latam: 'Acelga o espinaca', emea: 'Espinacas', usa: 'Spinach' }, eco: 'Espinacas congeladas', gourmet: 'Baby spinach fresca' },
                                    { name: 'Aguacate', qty: 50, unit: 'g', why: 'Grasa buena que ayuda a absorber todo lo nutritivo del plato. Un lubricante para tu cuerpo.', region: { latam: 'Palta (abundante)', emea: 'Aguacate', usa: 'Avocado' }, eco: 'Aceite de oliva (1 cda)', gourmet: 'Aguacate Hass' },
                                    { name: 'Limón', qty: 0.5, unit: 'ud', why: 'Multiplica por 3 el hierro que absorbes. Un truco simple que funciona.', region: { latam: 'Limón', emea: 'Limón', usa: 'Lemon' }, eco: 'Siempre asequible', gourmet: 'Limones orgánicos' }
                                ], 
                                steps: ['Pon a cocer la quinoa o el arroz (tarda 15 minutos)', 'Mientras, haz el pescado a la plancha 6-8 minutos por lado (o calienta las sardinas si son de lata)', 'Saltea las espinacas 3 minutos con un poco de ajo si quieres', 'Mezcla todo en el plato, añade el aguacate en trozos o el aceite, y exprime el limón por encima'], 
                                why: 'Este plato tiene TODO lo que tu cuerpo pide ahora: grasas que calman, proteína que fortalece, hierro que energiza. Es como darle a tu cuerpo exactamente lo que necesita para sentirse bien.'
                            },
                            { 
                                name: 'Lentejas que Te Abrazan', 
                                meal: 'Cena',
                                horario: '7:00-8:30 PM',
                                whyHorario: '2-3 horas antes de dormir. Tu cuerpo necesita tiempo para digerir. Proteína vegetal ligera prepara tu sueño sin pesadez.',
                                calories: 410, 
                                time: '35 min', 
                                ingredients: [
                                    { name: 'Lentejas', qty: 150, unit: 'g', why: 'Tienen algo que tu cerebro convierte en la hormona del sueño. Cena esto y dormirás mejor.', region: { latam: 'Lentejas', emea: 'Lentejas', usa: 'Lentils' }, eco: 'Lentejas secas (muy baratas)', gourmet: 'Lentejas rojas (más rápidas)' }, 
                                    { name: 'Zanahoria', qty: 100, unit: 'g', why: 'Vitamina A para tu piel y mucosas que están más secas ahora. Las hidrata desde dentro.', region: { latam: 'Zanahoria', emea: 'Zanahoria', usa: 'Carrots' }, eco: 'Siempre asequible', gourmet: 'Zanahorias baby' },
                                    { name: 'Pimiento', qty: 80, unit: 'g', why: 'Vitamina C a tope. Ayuda a que tu cuerpo aproveche todo el hierro de las lentejas.', region: { latam: 'Ají morrón', emea: 'Pimiento rojo', usa: 'Bell pepper' }, eco: 'De temporada', gourmet: 'Pimientos orgánicos' },
                                    { name: 'Cúrcuma', qty: 1, unit: 'cdta', why: 'Antiinflamatorio natural. Si te duelen las articulaciones, esto ayuda de verdad.', region: { latam: 'Cúrcuma molida', emea: 'Cúrcuma', usa: 'Turmeric' }, eco: 'Cúrcuma molida', gourmet: 'Cúrcuma fresca' },
                                    { name: 'Verduras de hoja', qty: 50, unit: 'g', why: 'Magnesio que relaja tus músculos. Te prepara para dormir profundo.', region: { latam: 'Acelga', emea: 'Espinacas', usa: 'Kale or spinach' }, eco: 'Acelga', gourmet: 'Kale orgánico' }
                                ], 
                                steps: ['Sofríe cebolla, zanahoria y pimiento unos 5 minutos hasta que huelan bien', 'Añade las lentejas, las especias y caldo o agua', 'Deja cocinar 20-35 minutos (depende del tipo de lenteja)', 'Los últimos 3 minutos echa las verduras de hoja'], 
                                why: 'Esta cena es ligera pero te llena. Tiene ingredientes que le dicen a tu cuerpo: "es hora de relajarse". El magnesio relaja, el triptófano se convierte en melatonina, y la cúrcuma calma cualquier dolor que no te deje dormir.'
                            },
                            { 
                                name: 'Snack Pre-Sueño Perfecto', 
                                meal: 'Snack',
                                horario: '9:00-10:00 PM',
                                whyHorario: '1-2 horas antes de acostarte. Calcio se absorbe mejor de noche. Triptófano necesita 60-90 min para convertirse en melatonina.',
                                calories: 280, 
                                time: '5 min', 
                                ingredients: [
                                    { name: 'Yogur natural', qty: 170, unit: 'g', why: 'Calcio que tu cuerpo absorbe mejor por la noche. Y bacterias buenas para tu digestión.', region: { latam: 'Yogur natural', emea: 'Yogur', usa: 'Plain yogurt' }, eco: 'Yogur natural básico', gourmet: 'Yogur griego 0%' }, 
                                    { name: 'Nueces', qty: 20, unit: 'g', why: 'Tienen melatonina natural. Como una pastilla para dormir, pero de verdad.', region: { latam: 'Maní o nueces', emea: 'Nueces', usa: 'Walnuts' }, eco: 'Cacahuetes', gourmet: 'Nueces de California' },
                                    { name: 'Fruta fresca', qty: 1, unit: 'ud', why: 'Algo de azúcar natural que ayuda al triptófano a llegar a tu cerebro y convertirse en sueño.', region: { latam: 'Plátano o manzana', emea: 'Kiwi', usa: 'Kiwi or apple' }, eco: 'Manzana o plátano', gourmet: 'Kiwi (tiene serotonina)' },
                                    { name: 'Semillas molidas', qty: 10, unit: 'g', why: 'Actúan como estrógenos suaves en tu cuerpo. Muchas mujeres notan menos sofocos con esto.', region: { latam: 'Lino molido', emea: 'Semillas de lino', usa: 'Ground flaxseed' }, eco: 'Lino molido en casa', gourmet: 'Mix chía + lino' }
                                ], 
                                steps: ['Pon el yogur en un bol', 'Pica las nueces y échalas', 'Corta la fruta en trozos', 'Espolvorea las semillas molidas por encima'], 
                                why: 'Come esto 1-2 horas antes de acostarte. Tiene todo para preparar tu cuerpo para un sueño profundo: calcio que se absorbe de noche, melatonina natural de las nueces, y algo dulce que calma la ansiedad nocturna.'
                            }
                        ],
                        martes: [
                            { name: 'Huevos Revueltos', meal: 'Desayuno', calories: 340, time: '10 min', ingredients: [{ name: 'Huevos', qty: 2, unit: 'piezas', why: 'Proteína completa' }], steps: ['Revuelve huevos'], why: 'Proteína pura' },
                            { name: 'Salmón al Horno', meal: 'Almuerzo', calories: 480, time: '20 min', ingredients: [{ name: 'Salmón', qty: 200, unit: 'g', why: 'Omega-3' }], steps: ['Hornea salmón'], why: 'Reduce inflamación' },
                            { name: 'Tofu a la Plancha', meal: 'Cena', calories: 320, time: '15 min', ingredients: [{ name: 'Tofu firme', qty: 250, unit: 'g', why: 'Proteína vegetal' }], steps: ['Sofríe tofu'], why: 'Opción vegana' },
                            { name: 'Batido Verde', meal: 'Snack', calories: 200, time: '5 min', ingredients: [{ name: 'Espinacas', qty: 50, unit: 'g', why: 'Minerales' }], steps: ['Licúa'], why: 'Snack refrescante' }
                        ],
                        miercoles: [
                            { name: 'Granola Casera', meal: 'Desayuno', calories: 380, time: '10 min', ingredients: [{ name: 'Granola', qty: 50, unit: 'g', why: 'Fibra' }], steps: ['Sirve'], why: 'Desayuno cómodo' },
                            { name: 'Pavo con Boniato', meal: 'Almuerzo', calories: 460, time: '25 min', ingredients: [{ name: 'Pechuga pavo', qty: 250, unit: 'g', why: 'Proteína magra' }], steps: ['Cocina'], why: 'Comida completa' },
                            { name: 'Garbanzos al Horno', meal: 'Cena', calories: 360, time: '20 min', ingredients: [{ name: 'Garbanzos cocidos', qty: 250, unit: 'g', why: 'Proteína vegetal' }], steps: ['Hornea'], why: 'Cena vegetariana' },
                            { name: 'Frutos Secos', meal: 'Snack', calories: 220, time: '2 min', ingredients: [{ name: 'Almendras', qty: 30, unit: 'g', why: 'Proteína' }], steps: ['Sirve'], why: 'Snack energético' }
                        ],
                        jueves: [
                            { name: 'Pudding de Chía', meal: 'Desayuno', calories: 320, time: '8 min', ingredients: [{ name: 'Semillas chía', qty: 30, unit: 'g', why: 'Omega-3' }], steps: ['Mezcla'], why: 'Desayuno que hidrata' },
                            { name: 'Atún a la Plancha', meal: 'Almuerzo', calories: 500, time: '15 min', ingredients: [{ name: 'Filete atún', qty: 200, unit: 'g', why: 'Omega-3' }], steps: ['Asa atún'], why: 'Pescado azul' },
                            { name: 'Pollo al Horno', meal: 'Cena', calories: 400, time: '30 min', ingredients: [{ name: 'Muslo pollo', qty: 250, unit: 'g', why: 'Proteína' }], steps: ['Hornea'], why: 'Cena reconfortante' },
                            { name: 'Manzana con Almendras', meal: 'Snack', calories: 200, time: '3 min', ingredients: [{ name: 'Manzana', qty: 1, unit: 'pieza', why: 'Fibra' }], steps: ['Sirve'], why: 'Snack dulce' }
                        ],
                        viernes: [
                            { name: 'Panqueques Integrales', meal: 'Desayuno', calories: 400, time: '20 min', ingredients: [{ name: 'Harina integral', qty: 100, unit: 'g', why: 'Fibra' }], steps: ['Cocina'], why: 'Desayuno festivo' },
                            { name: 'Merluza a la Sal', meal: 'Almuerzo', calories: 420, time: '25 min', ingredients: [{ name: 'Filete merluza', qty: 250, unit: 'g', why: 'Proteína magra' }], steps: ['Hornea'], why: 'Pescado blanco' },
                            { name: 'Pasta de Verdura', meal: 'Cena', calories: 380, time: '20 min', ingredients: [{ name: 'Pasta integral', qty: 150, unit: 'g', why: 'Fibra' }], steps: ['Cuece'], why: 'Clásico italiano' },
                            { name: 'Chocolate Oscuro', meal: 'Snack', calories: 200, time: '2 min', ingredients: [{ name: 'Chocolate 85%', qty: 30, unit: 'g', why: 'Antioxidantes' }], steps: ['Sirve'], why: 'Snack gourmet' }
                        ],
                        sabado: [
                            { name: 'Brunch Completo', meal: 'Desayuno', calories: 450, time: '25 min', ingredients: [{ name: 'Huevos', qty: 2, unit: 'piezas', why: 'Proteína' }], steps: ['Fríe'], why: 'Brunch italiano' },
                            { name: 'Carne Magra', meal: 'Almuerzo', calories: 520, time: '20 min', ingredients: [{ name: 'Carne magra', qty: 250, unit: 'g', why: 'Proteína' }], steps: ['Asa'], why: 'Proteína fuerte' },
                            { name: 'Ratatouille', meal: 'Cena', calories: 300, time: '30 min', ingredients: [{ name: 'Verduras variadas', qty: 400, unit: 'g', why: 'Vitaminas' }], steps: ['Sofríe'], why: 'Cena francesa' },
                            { name: 'Té con Galletas', meal: 'Snack', calories: 180, time: '5 min', ingredients: [{ name: 'Té verde', qty: 250, unit: 'ml', why: 'Antioxidantes' }], steps: ['Prepara'], why: 'Merienda acogedora' }
                        ],
                        domingo: [
                            { name: 'Smoothie Bowl', meal: 'Desayuno', calories: 420, time: '10 min', ingredients: [{ name: 'Arándanos', qty: 100, unit: 'g', why: 'Antioxidantes' }], steps: ['Mezcla'], why: 'Desayuno festivo' },
                            { name: 'Pollo Asado', meal: 'Almuerzo', calories: 500, time: '40 min', ingredients: [{ name: 'Pollo entero', qty: 400, unit: 'g', why: 'Proteína' }], steps: ['Asa'], why: 'Almuerzo abundante' },
                            { name: 'Ceviche Vegetal', meal: 'Cena', calories: 320, time: '20 min', ingredients: [{ name: 'Palmitos', qty: 200, unit: 'g', why: 'Proteína vegetal' }], steps: ['Mezcla'], why: 'Cena sofisticada' },
                            { name: 'Frutas de Temporada', meal: 'Snack', calories: 150, time: '5 min', ingredients: [{ name: 'Frutas variadas', qty: 300, unit: 'g', why: 'Vitaminas' }], steps: ['Sirve'], why: 'Snack natural' }
                        ]
                    },
                    en: {
                        lunes: [
                            { name: 'Oatmeal with Berries', meal: 'Desayuno', calories: 380, time: '10 min', ingredients: [{ name: 'Whole oats', qty: 50, unit: 'g', why: 'Fiber and satiety' }, { name: 'Skim milk', qty: 200, unit: 'ml', why: 'Protein, calcium' }, { name: 'Blueberries', qty: 80, unit: 'g', why: 'Antioxidants' }], steps: ['Heat milk', 'Add oats', 'Cook 8 min', 'Add berries'], why: 'Stabilizes glucose and energy' },
                            { name: 'Chicken and Quinoa Salad', meal: 'Almuerzo', calories: 520, time: '20 min', ingredients: [{ name: 'Chicken breast', qty: 200, unit: 'g', why: 'Lean protein' }, { name: 'Cooked quinoa', qty: 100, unit: 'g', why: 'Complete protein' }], steps: ['Cook chicken', 'Prepare quinoa', 'Mix all'], why: 'High protein stabilizes hormones' },
                            { name: 'Spiced Lentils', meal: 'Cena', calories: 380, time: '30 min', ingredients: [{ name: 'Red lentils', qty: 200, unit: 'g', why: 'Plant protein' }, { name: 'Turmeric', qty: 0.5, unit: 'tsp', why: 'Anti-inflammatory' }], steps: ['Sauté onion', 'Add lentils', 'Cook 30 min'], why: 'Promotes restful sleep' },
                            { name: 'Greek Yogurt', meal: 'Snack', calories: 250, time: '5 min', ingredients: [{ name: 'Greek yogurt', qty: 150, unit: 'g', why: 'Protein and probiotics' }, { name: 'Blueberries', qty: 80, unit: 'g', why: 'Antioxidants' }], steps: ['Pour yogurt', 'Add berries'], why: 'Nutritious snack' }
                        ],
                        martes: [
                            { name: 'Scrambled Eggs', meal: 'Desayuno', calories: 340, time: '10 min', ingredients: [{ name: 'Eggs', qty: 2, unit: 'pcs', why: 'Complete protein' }], steps: ['Scramble eggs'], why: 'Pure protein' },
                            { name: 'Baked Salmon', meal: 'Almuerzo', calories: 480, time: '20 min', ingredients: [{ name: 'Salmon', qty: 200, unit: 'g', why: 'Omega-3' }], steps: ['Bake salmon'], why: 'Reduces inflammation' },
                            { name: 'Grilled Tofu', meal: 'Cena', calories: 320, time: '15 min', ingredients: [{ name: 'Firm tofu', qty: 250, unit: 'g', why: 'Plant protein' }], steps: ['Sauté tofu'], why: 'Vegan option' },
                            { name: 'Green Smoothie', meal: 'Snack', calories: 200, time: '5 min', ingredients: [{ name: 'Spinach', qty: 50, unit: 'g', why: 'Minerals' }], steps: ['Blend'], why: 'Refreshing snack' }
                        ],
                        miercoles: [
                            { name: 'Homemade Granola', meal: 'Desayuno', calories: 380, time: '10 min', ingredients: [{ name: 'Granola', qty: 50, unit: 'g', why: 'Fiber' }], steps: ['Serve'], why: 'Convenient breakfast' },
                            { name: 'Turkey with Sweet Potato', meal: 'Almuerzo', calories: 460, time: '25 min', ingredients: [{ name: 'Turkey breast', qty: 250, unit: 'g', why: 'Lean protein' }], steps: ['Cook'], why: 'Complete meal' },
                            { name: 'Roasted Chickpeas', meal: 'Cena', calories: 360, time: '20 min', ingredients: [{ name: 'Cooked chickpeas', qty: 250, unit: 'g', why: 'Plant protein' }], steps: ['Roast'], why: 'Vegetarian dinner' },
                            { name: 'Mixed Nuts', meal: 'Snack', calories: 220, time: '2 min', ingredients: [{ name: 'Almonds', qty: 30, unit: 'g', why: 'Protein' }], steps: ['Serve'], why: 'Energetic snack' }
                        ],
                        jueves: [
                            { name: 'Chia Pudding', meal: 'Desayuno', calories: 320, time: '8 min', ingredients: [{ name: 'Chia seeds', qty: 30, unit: 'g', why: 'Omega-3' }], steps: ['Mix'], why: 'Hydrating breakfast' },
                            { name: 'Grilled Tuna', meal: 'Almuerzo', calories: 500, time: '15 min', ingredients: [{ name: 'Tuna fillet', qty: 200, unit: 'g', why: 'Omega-3' }], steps: ['Grill tuna'], why: 'Blue fish' },
                            { name: 'Baked Chicken', meal: 'Cena', calories: 400, time: '30 min', ingredients: [{ name: 'Chicken thigh', qty: 250, unit: 'g', why: 'Protein' }], steps: ['Bake'], why: 'Comforting dinner' },
                            { name: 'Apple with Almonds', meal: 'Snack', calories: 200, time: '3 min', ingredients: [{ name: 'Apple', qty: 1, unit: 'pc', why: 'Fiber' }], steps: ['Serve'], why: 'Sweet snack' }
                        ],
                        viernes: [
                            { name: 'Whole Wheat Pancakes', meal: 'Desayuno', calories: 400, time: '20 min', ingredients: [{ name: 'Whole wheat flour', qty: 100, unit: 'g', why: 'Fiber' }], steps: ['Cook'], why: 'Festive breakfast' },
                            { name: 'Salt-baked Hake', meal: 'Almuerzo', calories: 420, time: '25 min', ingredients: [{ name: 'Hake fillet', qty: 250, unit: 'g', why: 'Lean protein' }], steps: ['Bake'], why: 'White fish' },
                            { name: 'Vegetable Pasta', meal: 'Cena', calories: 380, time: '20 min', ingredients: [{ name: 'Whole wheat pasta', qty: 150, unit: 'g', why: 'Fiber' }], steps: ['Cook'], why: 'Italian classic' },
                            { name: 'Dark Chocolate', meal: 'Snack', calories: 200, time: '2 min', ingredients: [{ name: 'Dark chocolate 85%', qty: 30, unit: 'g', why: 'Antioxidants' }], steps: ['Serve'], why: 'Gourmet snack' }
                        ],
                        sabado: [
                            { name: 'Complete Brunch', meal: 'Desayuno', calories: 450, time: '25 min', ingredients: [{ name: 'Eggs', qty: 2, unit: 'pcs', why: 'Protein' }], steps: ['Fry'], why: 'Italian brunch' },
                            { name: 'Lean Meat', meal: 'Almuerzo', calories: 520, time: '20 min', ingredients: [{ name: 'Lean meat', qty: 250, unit: 'g', why: 'Protein' }], steps: ['Grill'], why: 'Strong protein' },
                            { name: 'Ratatouille', meal: 'Cena', calories: 300, time: '30 min', ingredients: [{ name: 'Mixed vegetables', qty: 400, unit: 'g', why: 'Vitamins' }], steps: ['Sauté'], why: 'French dinner' },
                            { name: 'Tea with Cookies', meal: 'Snack', calories: 180, time: '5 min', ingredients: [{ name: 'Green tea', qty: 250, unit: 'ml', why: 'Antioxidants' }], steps: ['Prepare'], why: 'Cozy afternoon' }
                        ],
                        domingo: [
                            { name: 'Smoothie Bowl', meal: 'Desayuno', calories: 420, time: '10 min', ingredients: [{ name: 'Blueberries', qty: 100, unit: 'g', why: 'Antioxidants' }], steps: ['Mix'], why: 'Festive breakfast' },
                            { name: 'Roast Chicken', meal: 'Almuerzo', calories: 500, time: '40 min', ingredients: [{ name: 'Whole chicken', qty: 400, unit: 'g', why: 'Protein' }], steps: ['Roast'], why: 'Abundant lunch' },
                            { name: 'Vegetable Ceviche', meal: 'Cena', calories: 320, time: '20 min', ingredients: [{ name: 'Hearts of palm', qty: 200, unit: 'g', why: 'Plant protein' }], steps: ['Mix'], why: 'Sophisticated dinner' },
                            { name: 'Seasonal Fruits', meal: 'Snack', calories: 150, time: '5 min', ingredients: [{ name: 'Mixed fruits', qty: 300, unit: 'g', why: 'Vitamins' }], steps: ['Serve'], why: 'Natural snack' }
                        ]
                    }
                };
                
                // SIEMPRE devolver menús base (personalización futura)
                // if (!currentUser) return baseMenus; // Comentado para debug
                
                // TODO: Aquí iría lógica de filtrado avanzado según:
                // - currentUser?.conditions (diabetes, celiaquía, etc.)
                // - Síntomas registrados (sofocos, insomnio, etc.)
                // - currentUser?.tdee (ajustar calorías)
                // Por ahora, devolvemos menús base siempre
                
                return baseMenus;
            };

            // EJERCICIOS
            const getExercises = () => {
                const allExercises = {
                    strength: [
                        { 
                            name: 'Sentadillas', 
                            duration: '20 min', 
                            difficulty: 'Moderada', 
                            freq: '3x semana', 
                            day: language === 'es' ? 'Lunes' : 'Monday', 
                            why: language === 'es' ? 'Aumenta densidad ósea (1-3% anual). Previene osteoporosis crucial en esta etapa.' : 'Increases bone density (1-3% per year). Prevents osteoporosis critical at this stage.', 
                            science: language === 'es' ? 'Ejercicio de resistencia aumenta masa ósea más que cardio. Pierdes 1% óseo anual sin ejercicio.' : 'Resistance exercise increases bone mass more than cardio. You lose 1% bone annually without exercise.',
                            steps: language === 'es' ? [
                                'Pies separados ancho de hombros, dedos ligeramente hacia afuera',
                                'Mantén espalda recta, pecho hacia afuera, brazos adelante para equilibrio',
                                'Baja doblando rodillas y caderas como si te sentaras (3 segundos)',
                                'Baja hasta muslos paralelos al suelo, rodillas NO pasan dedos pies',
                                'Sube empujando con talones, apretando glúteos (2 segundos)',
                                'Haz 3 series x 10-15 repeticiones, descansa 60 seg entre series',
                                'Si te cuesta: Pon silla detrás, baja hasta tocarla sin sentarte',
                                'Equipo: NINGUNO (peso corporal)'
                            ] : [
                                'Feet shoulder-width apart, toes slightly outward',
                                'Keep back straight, chest out, arms forward for balance',
                                'Lower by bending knees and hips like sitting in chair (3 seconds)',
                                'Lower until thighs parallel to ground, knees DON\'T pass toes',
                                'Rise pushing through heels, squeezing glutes (2 seconds)',
                                'Do 3 sets x 10-15 reps, rest 60 sec between sets',
                                'If difficult: Put chair behind, lower until touching without sitting',
                                'Equipment: NONE (bodyweight)'
                            ]
                        },
                        { 
                            name: language === 'es' ? 'Flexiones en Pared' : 'Wall Push-ups', 
                            duration: '15 min', 
                            difficulty: language === 'es' ? 'Fácil-Moderada' : 'Easy-Moderate', 
                            freq: '2x semana', 
                            day: language === 'es' ? 'Miércoles' : 'Wednesday', 
                            why: language === 'es' ? 'Fortalece pecho, brazos y core. Mejora postura sin impacto en muñecas.' : 'Strengthens chest, arms and core. Improves posture without wrist impact.', 
                            science: language === 'es' ? 'Pérdida de estrógeno causa pérdida de 0.5-1% muscular anual. Ejercicio de resistencia ralentiza esto.' : 'Estrogen loss causes 0.5-1% muscle loss annually. Resistance exercise slows this.',
                            steps: language === 'es' ? [
                                'Párate frente a pared, distancia 60-80cm',
                                'Manos en pared altura hombros, separadas ancho hombros',
                                'Cuerpo forma línea recta desde cabeza a talones, abdomen tenso',
                                'Baja pecho hacia pared doblando codos (3 segundos)',
                                'Codos a 45° del cuerpo, nariz casi toca pared',
                                'Empuja para volver arriba sin bloquear codos (2 segundos)',
                                'Haz 3 series x 10-15 repeticiones, descansa 60 seg',
                                'Progresión: Semana 3-4 usa mesa más baja, semana 5+ banco',
                                'Equipo: Solo pared'
                            ] : [
                                'Stand facing wall, 60-80cm away',
                                'Hands on wall shoulder height, shoulder-width apart',
                                'Body forms straight line head to heels, abs tight',
                                'Lower chest to wall bending elbows (3 seconds)',
                                'Elbows 45° from body, nose almost touches wall',
                                'Push back up without locking elbows (2 seconds)',
                                'Do 3 sets x 10-15 reps, rest 60 sec',
                                'Progression: Week 3-4 use lower table, week 5+ bench',
                                'Equipment: Just wall'
                            ]
                        },
                        { 
                            name: language === 'es' ? 'Levantamiento de Mancuernas' : 'Dumbbell Lifting', 
                            duration: '25 min', 
                            difficulty: 'Moderada', 
                            freq: '3x semana', 
                            day: language === 'es' ? 'Viernes' : 'Friday', 
                            why: language === 'es' ? 'Incrementa fuerza y masa muscular. Acelera metabolismo 5-7%.' : 'Increases strength and muscle mass. Accelerates metabolism 5-7%.', 
                            science: language === 'es' ? 'Cada kg de músculo quema 6 calorías en reposo. Es tu aliado metabólico en esta etapa.' : 'Each kg of muscle burns 6 calories at rest. It\'s your metabolism ally at this stage.',
                            steps: language === 'es' ? [
                                'Pies separados ancho hombros, rodillas ligeramente flexionadas',
                                'Mancuernas a los lados, palmas hacia cuerpo (2-5kg para empezar)',
                                'Levanta brazos laterales hasta altura hombros formando T',
                                'Mantén codos ligeramente flexionados, no uses impulso del cuerpo',
                                'Baja controlado en 3 segundos',
                                'Haz 3 series x 10-12 repeticiones, descansa 60 seg',
                                'NO subas más arriba de hombros, NO balancees cuerpo',
                                'Alternativa SIN mancuernas: Usa botellas de agua 1L',
                                'Equipo: Mancuernas 2-5kg O botellas de agua'
                            ] : [
                                'Feet shoulder-width, knees slightly bent',
                                'Dumbbells at sides, palms facing body (4-10lbs to start)',
                                'Lift arms laterally to shoulder height forming T',
                                'Keep elbows slightly bent, don\'t use body momentum',
                                'Lower controlled in 3 seconds',
                                'Do 3 sets x 10-12 reps, rest 60 sec',
                                'DON\'T raise above shoulders, DON\'T swing body',
                                'Alternative WITHOUT dumbbells: Use 1L water bottles',
                                'Equipment: 4-10lb dumbbells OR water bottles'
                            ]
                        },
                        { 
                            name: language === 'es' ? 'Planchas Abdominales' : 'Planks', 
                            duration: '10 min', 
                            difficulty: 'Moderada', 
                            freq: '3x semana', 
                            day: language === 'es' ? 'Martes' : 'Tuesday', 
                            why: language === 'es' ? 'Fortalece core. Mejora estabilidad y postura.' : 'Strengthens core. Improves stability and posture.', 
                            science: language === 'es' ? 'Core fuerte previene caídas (comunes en mujeres 40-55) y reduce dolor de espalda 60%.' : 'Strong core prevents falls (common in 40-55 year old women) and reduces back pain 60%.',
                            steps: language === 'es' ? [
                                'Posición inicial: Apoya antebrazos en el suelo, codos bajo hombros',
                                'Extiende piernas atrás, apoyada en puntas de pies',
                                'Forma línea recta desde cabeza a talones (NO hundas caderas)',
                                'Activa abdomen como si te fueran a golpear, aprieta glúteos',
                                'Mantén la posición: Principiante 20-30 seg, Intermedio 45-60 seg',
                                'Descansa 30-60 seg entre series',
                                'Haz 3-4 series totales',
                                'Variante más fácil: Apoya rodillas en suelo en vez de pies',
                                'Equipo: Solo colchoneta'
                            ] : [
                                'Starting position: Support on forearms, elbows under shoulders',
                                'Extend legs back, supported on toes',
                                'Form straight line from head to heels (DON\'T sag hips)',
                                'Engage abs as if about to be punched, squeeze glutes',
                                'Hold position: Beginner 20-30 sec, Intermediate 45-60 sec',
                                'Rest 30-60 sec between sets',
                                'Do 3-4 total sets',
                                'Easier variant: Support knees on floor instead of feet',
                                'Equipment: Just mat'
                            ]
                        },
                        { 
                            name: language === 'es' ? 'Desplantes' : 'Lunges', 
                            duration: '20 min', 
                            difficulty: 'Moderada', 
                            freq: '2x semana', 
                            day: language === 'es' ? 'Jueves' : 'Thursday', 
                            why: language === 'es' ? 'Trabaja piernas y equilibrio. Funcional para vida diaria.' : 'Works legs and balance. Functional for daily life.', 
                            science: language === 'es' ? 'Mejora propiocepción. Previene lesiones por caídas que son 3x más frecuentes en esta etapa.' : 'Improves proprioception. Prevents fall injuries which are 3x more frequent at this stage.',
                            steps: language === 'es' ? [
                                'Párate derecha, pies ancho de caderas',
                                'Da un paso largo adelante con pierna derecha',
                                'Baja cadera hasta rodilla trasera casi toca suelo',
                                'Rodilla delantera a 90°, NO pasa dedos pie',
                                'Empuja con talón delantero para volver arriba',
                                'Alterna piernas o haz todas de un lado primero',
                                'Haz 3 series x 10-12 repeticiones por pierna',
                                'Principiante: Agárrate de silla para equilibrio',
                                'Equipo: NINGUNO (o silla de apoyo)'
                            ] : [
                                'Stand straight, feet hip-width apart',
                                'Take long step forward with right leg',
                                'Lower hips until back knee almost touches floor',
                                'Front knee at 90°, DON\'T pass toes',
                                'Push through front heel to return up',
                                'Alternate legs or do all one side first',
                                'Do 3 sets x 10-12 reps per leg',
                                'Beginner: Hold chair for balance',
                                'Equipment: NONE (or chair for support)'
                            ]
                        },
                        { 
                            name: language === 'es' ? 'Remo con Banda' : 'Rowing with Band', 
                            duration: '15 min', 
                            difficulty: language === 'es' ? 'Fácil-Moderada' : 'Easy-Moderate', 
                            freq: '2x semana', 
                            day: language === 'es' ? 'Sábado' : 'Saturday', 
                            why: language === 'es' ? 'Fortalece espalda. Mejora postura que se debilita con cambios hormonales.' : 'Strengthens back. Improves posture that weakens with hormonal changes.', 
                            science: language === 'es' ? 'Estrógeno soportaba musculatura. Sin él, necesitas refuerzo activo. Remo restaura alineación.' : 'Estrogen supported muscles. Without it, you need active reinforcement. Rowing restores alignment.',
                            steps: language === 'es' ? [
                                'Siéntate en suelo, piernas extendidas adelante',
                                'Pasa banda elástica por plantas de pies, agarra extremos',
                                'Espalda recta, pecho hacia afuera',
                                'Tira banda hacia tu abdomen, codos pegados al cuerpo',
                                'Aprieta omóplatos atrás al final del movimiento',
                                'Vuelve controlado a posición inicial',
                                'Haz 3 series x 12-15 repeticiones',
                                'Sin banda: Usa toalla pasada bajo pies',
                                'Equipo: Banda elástica €5-10 O toalla'
                            ] : [
                                'Sit on floor, legs extended forward',
                                'Pass elastic band under feet, grab ends',
                                'Back straight, chest out',
                                'Pull band to abdomen, elbows close to body',
                                'Squeeze shoulder blades back at end of movement',
                                'Return controlled to starting position',
                                'Do 3 sets x 12-15 reps',
                                'Without band: Use towel passed under feet',
                                'Equipment: Elastic band €5-10 OR towel'
                            ]
                        }
                    ],
                    weightLoss: [
                        { 
                            name: language === 'es' ? 'Caminata Rápida' : 'Brisk Walking', 
                            duration: '30 min', 
                            difficulty: language === 'es' ? 'Fácil' : 'Easy', 
                            freq: '5-7x semana', 
                            day: language === 'es' ? 'Diariamente' : 'Daily', 
                            why: language === 'es' ? 'Quema 200-300 calorías. Accesible, bajo impacto, social.' : 'Burns 200-300 calories. Accessible, low impact, social.', 
                            science: language === 'es' ? 'Cardio moderado mejora sensibilidad insulínica (baja en esta etapa). Reduce sofocos 30-40%.' : 'Moderate cardio improves insulin sensitivity (low at this stage). Reduces hot flashes 30-40%.',
                            steps: language === 'es' ? [
                                'Ritmo rápido: Puedes hablar pero no cantar (zona aeróbica)',
                                'Brazos doblados a 90°, muévelos al ritmo de pasos',
                                'Talón toca suelo primero, impulsa con dedos',
                                'Postura recta, mirada al frente, hombros relajados',
                                'Primeros 5 min: Calentamiento ritmo suave',
                                'Minutos 6-25: Ritmo rápido constante',
                                'Últimos 5 min: Enfriamiento bajando ritmo',
                                'Ideal: Parques, paseo marítimo, caminadoras',
                                'Equipo: Zapatillas cómodas'
                            ] : [
                                'Brisk pace: Can talk but not sing (aerobic zone)',
                                'Arms bent 90°, move with step rhythm',
                                'Heel touches ground first, push off with toes',
                                'Straight posture, look forward, shoulders relaxed',
                                'First 5 min: Warm-up gentle pace',
                                'Minutes 6-25: Constant brisk pace',
                                'Last 5 min: Cool down slowing pace',
                                'Ideal: Parks, boardwalk, treadmills',
                                'Equipment: Comfortable shoes'
                            ]
                        },
                        { 
                            name: language === 'es' ? 'Bicicleta Estática' : 'Stationary Bike', 
                            duration: '30 min', 
                            difficulty: 'Moderada', 
                            freq: '3-4x semana', 
                            day: language === 'es' ? 'Lunes, Miércoles, Viernes' : 'Mon, Wed, Fri', 
                            why: language === 'es' ? 'Quema 250-400 calorías. Sin impacto articular.' : 'Burns 250-400 calories. No joint impact.', 
                            science: language === 'es' ? 'Cardio aeróbico reduce grasa visceral (la más peligrosa). Disminuye riesgo cardiovascular 35%.' : 'Aerobic cardio reduces visceral fat (the most dangerous). Reduces cardiovascular risk 35%.',
                            steps: language === 'es' ? [
                                'Ajusta sillín: Rodilla ligeramente flexionada cuando pedal abajo',
                                'Resistencia moderada: Puedes mantener conversación',
                                'Primeros 5 min: Resistencia baja para calentar',
                                'Minutos 6-25: Aumenta resistencia, mantén ritmo constante',
                                'Últimos 5 min: Baja resistencia, pedalea suave',
                                'Mantén espalda recta, hombros relajados',
                                'Manos sueltas en manillar, no te apoyes con peso',
                                'Alternativa: Bicicleta normal en ruta plana',
                                'Equipo: Bicicleta estática o normal'
                            ] : [
                                'Adjust seat: Knee slightly bent when pedal down',
                                'Moderate resistance: Can maintain conversation',
                                'First 5 min: Low resistance to warm up',
                                'Minutes 6-25: Increase resistance, maintain constant rhythm',
                                'Last 5 min: Lower resistance, pedal gently',
                                'Keep back straight, shoulders relaxed',
                                'Hands loose on handlebar, don\'t lean with weight',
                                'Alternative: Regular bike on flat route',
                                'Equipment: Stationary or regular bike'
                            ]
                        },
                        { name: 'HIIT (Intervalos)', duration: '20 min', difficulty: language === 'es' ? 'Alta' : 'High', freq: '2x semana', day: language === 'es' ? 'Martes, Jueves' : 'Tue, Thu', why: language === 'es' ? 'Máxima quema calórica en mínimo tiempo. Efecto EPOC (metabolismo acelerado 24h).' : 'Maximum calorie burn in minimum time. EPOC effect (accelerated metabolism 24h).', science: language === 'es' ? 'HIIT aumenta EPOC 25-30%. Eficiente cuando tienes poco tiempo. Aumenta VO2 máx 15-25%.' : 'HIIT increases EPOC 25-30%. Efficient when time is limited. Increases max VO2 15-25%.' },
                        { name: language === 'es' ? 'Saltar la Cuerda' : 'Jump Rope', duration: '15 min', difficulty: 'Moderada', freq: '2x semana', day: language === 'es' ? 'Miércoles, Sábado' : 'Wed, Sat', why: language === 'es' ? 'Quema 300+ calorías/30 min. Tonifica piernas y core.' : 'Burns 300+ calories/30 min. Tones legs and core.', science: language === 'es' ? 'Saltar fortalece huesos (crucial ahora). Quema más calorías que correr en mismo tiempo.' : 'Jumping strengthens bones (crucial now). Burns more calories than running in same time.' },
                        { 
                            name: language === 'es' ? 'Natación' : 'Swimming', 
                            duration: '45 min', 
                            difficulty: 'Moderada', 
                            freq: '2x semana', 
                            day: language === 'es' ? 'Lunes, Viernes' : 'Mon, Fri', 
                            why: language === 'es' ? 'Quema 300-400 calorías. Bajo impacto. Trabaja todo el cuerpo.' : 'Burns 300-400 calories. Low impact. Works entire body.', 
                            science: language === 'es' ? 'Natación trabaja 85% músculos. Mejora cardiovascular sin estrés articular. Reduce sofocos.' : 'Swimming works 85% of muscles. Improves cardiovascular health without joint stress. Reduces hot flashes.',
                            steps: language === 'es' ? [
                                'Estilo crol o espalda (más fáciles que mariposa)',
                                'Primeros 10 min: Nada suave para calentar',
                                'Minutos 11-35: Ritmo moderado constante',
                                'Últimos 10 min: Ritmo suave para enfriar',
                                'Respira cada 2-3 brazadas (no aguantes respiración)',
                                'Si no sabes nadar: Camina en agua hasta cintura',
                                'Alternativa: Aquagym en piscina',
                                'Equipo: Traje de baño, gorro, gafas'
                            ] : [
                                'Freestyle or backstroke (easier than butterfly)',
                                'First 10 min: Swim gently to warm up',
                                'Minutes 11-35: Constant moderate pace',
                                'Last 10 min: Gentle pace to cool down',
                                'Breathe every 2-3 strokes (don\'t hold breath)',
                                'If you can\'t swim: Walk in waist-deep water',
                                'Alternative: Water aerobics in pool',
                                'Equipment: Swimsuit, cap, goggles'
                            ]
                        },
                        { 
                            name: language === 'es' ? 'Elíptica' : 'Elliptical', 
                            duration: '25 min', 
                            difficulty: language === 'es' ? 'Moderada-Alta' : 'Moderate-High', 
                            freq: '3x semana', 
                            day: language === 'es' ? 'Martes, Jueves, Domingo' : 'Tue, Thu, Sun', 
                            why: language === 'es' ? 'Cardio intenso sin impacto. Quema 250-350 calorías.' : 'Intense cardio without impact. Burns 250-350 calories.', 
                            science: language === 'es' ? 'Bajo impacto pero intenso. Ideal para perder peso sin lesionar articulaciones.' : 'Low impact but intense. Ideal for weight loss without joint injury.',
                            steps: language === 'es' ? [
                                'Agarra manillares móviles (trabajas brazos y piernas)',
                                'Primeros 5 min: Resistencia baja, ritmo suave',
                                'Minutos 6-20: Aumenta resistencia, ritmo moderado-alto',
                                'Últimos 5 min: Baja resistencia, ritmo suave',
                                'Mantén espalda recta, no te inclines adelante',
                                'Pies completos en pedales (no solo puntas)',
                                'Alternativa: Caminadora con inclinación',
                                'Equipo: Máquina elíptica (gym o casa)'
                            ] : [
                                'Grab moving handles (work arms and legs)',
                                'First 5 min: Low resistance, gentle pace',
                                'Minutes 6-20: Increase resistance, moderate-high pace',
                                'Last 5 min: Lower resistance, gentle pace',
                                'Keep back straight, don\'t lean forward',
                                'Full feet on pedals (not just toes)',
                                'Alternative: Treadmill with incline',
                                'Equipment: Elliptical machine (gym or home)'
                            ]
                        }
                    ],
                    hormonal: [
                        { 
                            name: language === 'es' ? 'Yoga Suave' : 'Gentle Yoga', 
                            duration: '45 min', 
                            difficulty: language === 'es' ? 'Fácil' : 'Easy', 
                            freq: '3x semana', 
                            day: language === 'es' ? 'Lunes, Miércoles, Viernes' : 'Mon, Wed, Fri', 
                            why: language === 'es' ? 'Reduce estrés que desencadena sofocos. Mejora sueño 40% en estudios.' : 'Reduces stress that triggers hot flashes. Improves sleep 40% in studies.', 
                            science: language === 'es' ? 'Cortisol elevado empeora síntomas. Yoga reduce cortisol 25%. Restaura balance nervioso.' : 'High cortisol worsens symptoms. Yoga reduces cortisol 25%. Restores nervous balance.',
                            steps: language === 'es' ? [
                                'Busca clase "Yoga suave" o "Hatha yoga" para principiantes',
                                'Posturas básicas: Perro boca abajo, gato-vaca, niño',
                                'Mantén cada postura 5 respiraciones profundas',
                                'NO fuerces, el yoga NO duele',
                                'Enfócate en respiración lenta y profunda',
                                'Termina con 10 min de relajación tumbada',
                                'Online: Youtube "yoga suave" o apps como Down Dog',
                                'Equipo: Colchoneta de yoga'
                            ] : [
                                'Look for "Gentle yoga" or "Hatha yoga" for beginners',
                                'Basic poses: Downward dog, cat-cow, child',
                                'Hold each pose 5 deep breaths',
                                'DON\'T force, yoga doesn\'t hurt',
                                'Focus on slow, deep breathing',
                                'End with 10 min relaxation lying down',
                                'Online: Youtube "gentle yoga" or apps like Down Dog',
                                'Equipment: Yoga mat'
                            ]
                        },
                        { 
                            name: 'Tai Chi', 
                            duration: '40 min', 
                            difficulty: language === 'es' ? 'Fácil' : 'Easy', 
                            freq: '3x semana', 
                            day: language === 'es' ? 'Martes, Jueves, Sábado' : 'Tue, Thu, Sat', 
                            why: language === 'es' ? 'Meditación en movimiento. Mejora balance. Calma ansiedad.' : 'Moving meditation. Improves balance. Calms anxiety.', 
                            science: language === 'es' ? 'Estudios chinos: Tai Chi reduce sofocos 50%. Mejora sueño más que otros ejercicios en mujeres.' : 'Chinese studies: Tai Chi reduces hot flashes 50%. Improves sleep more than other exercises in women.',
                            steps: language === 'es' ? [
                                'Busca clase local de Tai Chi o videos "Tai Chi principiantes"',
                                'Movimientos lentos, fluidos, como en cámara lenta',
                                'Respira profundo y lento coordinando con movimientos',
                                'Enfoca mente en cada movimiento (meditación activa)',
                                'Practica descalza o con zapatillas flexibles',
                                'Ideal al aire libre (parque, jardín)',
                                'Online: Youtube "tai chi for beginners"',
                                'Equipo: NINGUNO (ropa cómoda)'
                            ] : [
                                'Find local Tai Chi class or videos "Tai Chi for beginners"',
                                'Slow, flowing movements, like slow motion',
                                'Breathe deep and slow coordinating with movements',
                                'Focus mind on each movement (active meditation)',
                                'Practice barefoot or flexible shoes',
                                'Ideal outdoors (park, garden)',
                                'Online: Youtube "tai chi for beginners"',
                                'Equipment: NONE (comfortable clothes)'
                            ]
                        },
                        { name: language === 'es' ? 'Pilates Core' : 'Pilates Core', duration: '30 min', difficulty: 'Moderada', freq: '2-3x semana', day: language === 'es' ? 'Lunes, Jueves' : 'Mon, Thu', why: language === 'es' ? 'Fortalece centro del cuerpo. Mejora postura. Estabilidad.' : 'Strengthens core body. Improves posture. Stability.', science: language === 'es' ? 'Fortalecimiento core reduce dolor de espalda 60%. Mejora postura que se cae con cambios hormonales.' : 'Core strengthening reduces back pain 60%. Improves posture that weakens with hormonal changes.' },
                        { name: language === 'es' ? 'Respiración Consciente' : 'Conscious Breathing', duration: '15 min', difficulty: language === 'es' ? 'Fácil' : 'Easy', freq: '4-5x semana', day: language === 'es' ? 'Diariamente' : 'Daily', why: language === 'es' ? 'Activa sistema nervioso parasimpático (calma). Reduce sofocos instantáneamente.' : 'Activates parasympathetic nervous system (calm). Reduces hot flashes instantly.', science: language === 'es' ? 'Respiración 4-4-6 reduce cortisol 30%. En sofoco: respira y baja 50% intensidad.' : '4-4-6 breathing reduces cortisol 30%. In a hot flash: breathe and reduce intensity 50%.' },
                        { name: language === 'es' ? 'Caminata Meditativa' : 'Meditative Walk', duration: '30 min', difficulty: language === 'es' ? 'Fácil' : 'Easy', freq: '5x semana', day: language === 'es' ? 'Diariamente' : 'Daily', why: language === 'es' ? 'Mezcla cardio suave con conexión emocional. Anti-ansiedad natural.' : 'Mixes light cardio with emotional connection. Natural anti-anxiety.', science: language === 'es' ? 'Naturaleza reduce cortisol 20 min. Caminar mejora serotonina (baja en perimenopáusia).' : 'Nature reduces cortisol in 20 min. Walking improves serotonin (low in perimenopause).' },
                        { name: language === 'es' ? 'Estiramientos Profundos' : 'Deep Stretching', duration: '20 min', difficulty: language === 'es' ? 'Fácil' : 'Easy', freq: '3x semana', day: language === 'es' ? 'Miércoles, Viernes, Domingo' : 'Wed, Fri, Sun', why: language === 'es' ? 'Libera tensión física. Mejora flexibilidad.' : 'Releases physical tension. Improves flexibility.', science: language === 'es' ? 'Estrés se almacena en músculos. Estiramientos liberan tensión y reduce cortisol.' : 'Stress is stored in muscles. Stretching releases tension and reduces cortisol.' }
                    ]
                };
                
                // PERSONALIZACIÓN: Ya filtra por exerciseGoal (strength/weightLoss/hormonal)
                // TODO futuro: Ajustar intensidad según edad y condiciones físicas
                return allExercises[exerciseGoal] || [];
            };

            // MITOS
            const getMythsAndTips = () => {
                return {
                    myths: language === 'es' ? [
                        { myth: 'Es una enfermedad que necesita medicación', truth: 'Es una transición natural con opciones de manejo', science: 'La etapa entre 40-55 es biológicamente natural. El estrógeno desciende 90% pero NO es patología sino cambio fisiológico.', action: 'Documenta síntomas 3 meses antes de considerar opciones médicas' },
                        { myth: 'Los sofocos duran 10+ años', truth: 'La mayoría dura 5-8 años. Intensidad disminuye con tiempo', science: 'Estudios: 65% resuelve en 8 años, 90% en 10. Intensidad máxima en años 1-3.', action: 'Ejercicio + sueño + estrés = sofocos 30-50% menos' },
                        { myth: 'Todas engordan', truth: 'El metabolismo baja pero es controlable', science: 'Metabolismo desciende 100-200 cal/día (5-8%). Pero ejercicio fuerza recupera 3-5%.', action: 'Aumenta proteína a 1.2-1.6g/kg peso y entrena fuerza' },
                        { myth: 'La vida sexual termina', truth: 'Mejora para muchas sin miedo anticonceptivos', science: 'Sequedad tratable con lubricantes. Libertad anticonceptiva aumenta satisfacción.', action: 'Lubricante + comunicación + paciencia = solución' }
                    ] : [
                        { myth: 'It\'s a disease needing medication', truth: 'It\'s a natural transition with management options', science: 'The 40-55 stage is biologically natural. Not pathology but physiological change. Estrogen drops 90% but this is natural, not disease.', action: 'Document symptoms for 3 months before considering medical options' },
                        { myth: 'Hot flashes last 10+ years', truth: 'Most last 5-8 years. Intensity decreases over time', science: 'Studies: 65% resolves in 8 years, 90% in 10. Maximum intensity in years 1-3.', action: 'Exercise + sleep + stress management = 30-50% fewer hot flashes' },
                        { myth: 'Everyone gains weight', truth: 'Metabolism drops but it\'s controllable', science: 'Metabolism decreases 100-200 cal/day (5-8%). But strength exercise recovers 3-5%.', action: 'Increase protein to 1.2-1.6g/kg weight and train with resistance' },
                        { myth: 'Sexual life ends', truth: 'Improves for many without contraceptive fears', science: 'Dryness is treatable with lubricants. Freedom from contraception increases satisfaction.', action: 'Lubricant + communication + patience = solution' }
                    ],
                    tips: language === 'es' ? [
                        { emoji: '🌙', title: 'Sueño 7-9 Horas', why: 'El sueño es reparación. Tu cuerpo NECESITA más sueño. Dormir 7+ horas reduce sofocos 40%.', how: '• Misma hora siempre\n• Sin pantallas tras las 21:00\n• Habitación 16-18°C' },
                        { emoji: '💪', title: 'Movimiento 30+ min Diario', why: 'Ejercicio es medicina. Reduce sofocos, mejora sueño, preserva hueso. Incrementa serotonina.', how: '• Cardio suave (caminar) 5 días\n• Fuerza 2-3 días\n• Flexibilidad (yoga) 2-3 días' },
                        { emoji: '🥗', title: 'Nutrición Real No Dietas', why: 'Dietas restrictivas empeoran síntomas. Necesitas nutrientes para neurotransmisores.', how: '• Proteína CADA comida (30-40g)\n• Come arcoíris\n• Grasas omega-3' },
                        { emoji: '✨', title: 'Respiración Profunda 5 min', why: 'Activa parasimpático (sistema calma). En sofoco: respira y baja 50% intensidad.', how: '• Inhalación 4 segundos\n• Retención 4 segundos\n• Exhalación 6 segundos' },
                        { emoji: '💜', title: 'Conexión Humana', why: 'Aislamiento amplifica ansiedad. Conexión reduce estrés 35%.', how: '• Busca círculo de mujeres\n• Habla sin tabúes\n• Comparte miedos' }
                    ] : [
                        { emoji: '🌙', title: 'Sleep 7-9 Hours', why: 'Sleep is repair. Your body NEEDS more sleep. Sleeping 7+ hours reduces hot flashes 40%.', how: '• Same time always\n• No screens after 9 PM\n• Room 16-18°C' },
                        { emoji: '💪', title: 'Movement 30+ min Daily', why: 'Exercise is medicine. Reduces hot flashes, improves sleep, preserves bone. Increases serotonin.', how: '• Light cardio (walking) 5 days\n• Strength 2-3 days\n• Flexibility (yoga) 2-3 days' },
                        { emoji: '🥗', title: 'Real Nutrition Not Diets', why: 'Restrictive diets worsen symptoms. You need nutrients for neurotransmitters.', how: '• Protein EVERY meal (30-40g)\n• Eat the rainbow\n• Omega-3 fats' },
                        { emoji: '✨', title: 'Deep Breathing 5 min', why: 'Activates parasympathetic (calm system). In hot flash: breathe and reduce intensity 50%.', how: '• Inhale 4 seconds\n• Hold 4 seconds\n• Exhale 6 seconds' },
                        { emoji: '💜', title: 'Human Connection', why: 'Isolation amplifies anxiety. Connection reduces stress 35%.', how: '• Find a circle of women\n• Talk without taboos\n• Share fears' }
                    ]
                };
            };

            // CUESTIONARIO
            // FUNCIONES AUTH Y PREMIUM
            const handleLogin = async () => {
                try {
                    const { data, error } = await supabase.auth.signInWithPassword({
                        email: authData.email,
                        password: authData.password
                    });
                    
                    if (error) {
                        alert(language === 'es' 
                            ? `Error: ${error.message}` 
                            : `Error: ${error.message}`);
                        return;
                    }
                    
                    // Cargar perfil del usuario
                    const { data: profile, error: profileError } = await supabase
                        .from('users')
                        .select('*')
                        .eq('id', data.user.id)
                        .single();
                    
                    if (profileError) {
                        console.error('Error cargando perfil:', profileError);
                    }
                    
                    setSession(data.session);
                    setCurrentUser(profile || { id: data.user.id, email: data.user.email });
                    setShowAuth(false);
                    
                    // Si no tiene perfil completo, mostrar quiz
                    if (!profile?.profile_name) {
                        setShowQuiz(true);
                    }
                    
                    console.log('✅ Login exitoso con Supabase');
                } catch (err) {
                    console.error('Error login:', err);
                    alert(language === 'es' ? 'Error al iniciar sesión' : 'Login error');
                }
            };
            
            const handleRegister = async () => {
                try {
                    // IMPORTANTE: Primero registrar en Auth (el trigger creará el perfil automáticamente)
                    const { data, error } = await supabase.auth.signUp({
                        email: authData.email,
                        password: authData.password
                    });
                    
                    if (error) {
                        // Error específico de usuario duplicado
                        if (error.message.includes('already registered')) {
                            alert(language === 'es' 
                                ? 'Este email ya está registrado. Intenta iniciar sesión.' 
                                : 'This email is already registered. Try logging in.');
                            setAuthMode('login');
                            return;
                        }
                        alert(language === 'es' 
                            ? `Error: ${error.message}` 
                            : `Error: ${error.message}`);
                        return;
                    }
                    
                    console.log('✅ Usuario creado en Auth:', data.user.id);
                    
                    // El trigger handle_new_user() ya creó el perfil en tabla users
                    // Ahora hacer login automático
                    setSession(data.session);
                    setCurrentUser({ id: data.user.id, email: data.user.email });
                    setShowAuth(false);
                    setShowQuiz(true); // Mostrar quiz para completar perfil
                    
                    console.log('✅ Registro exitoso con Supabase');
                } catch (err) {
                    console.error('Error registro:', err);
                    alert(language === 'es' ? 'Error al registrarse' : 'Registration error');
                }
            };
            
            const handleLogout = async () => {
                await supabase.auth.signOut();
                setSession(null);
                setCurrentUser(null);
                setShowAuth(true);
                setShowQuiz(false);
                console.log('✅ Logout exitoso');
            };
            
            const isPremium = () => currentUser?.subscription_status === 'active';
            
            const getRegion = () => {
                const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
                if (tz.includes('America')) return 'latam';
                if (tz.includes('Europe') || tz.includes('Africa')) return 'emea';
                return 'usa';
            };
            
            // STRIPE REAL - PRODUCCIÓN
            const handleSubscribe = async () => {
                if (!currentUser) { 
                    alert(language === 'es' ? 'Inicia sesión primero' : 'Please log in first'); 
                    return; 
                }
                
                const region = getRegion();
                const price = PRICES[region];
                
                try {
                    // Crear Checkout Session en backend
                    const response = await fetch(`${BACKEND_URL}/create-checkout-session`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            priceId: price.id,
                            userId: currentUser.id,
                            userEmail: currentUser.email
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Error creating checkout session');
                    }
                    
                    const { sessionId } = await response.json();
                    
                    // Redirigir a Stripe Checkout
                    const { error } = await stripe.redirectToCheckout({ sessionId });
                    
                    if (error) {
                        console.error('Error redirecting to checkout:', error);
                        alert(language === 'es' ? 'Error al procesar el pago' : 'Error processing payment');
                    }
                } catch (error) {
                    console.error('Error subscribe:', error);
                    alert(language === 'es' 
                        ? 'Error al conectar con el servidor de pagos. Intenta de nuevo.' 
                        : 'Error connecting to payment server. Try again.');
                }
            };

            const renderQuiz = () => {
                if (quizStep === 1) {
                    return (
                        <div className={`min-h-screen ${darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-purple-100 to-pink-100'} flex items-center justify-center p-4`}>
                            <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-2xl shadow-2xl p-12 max-w-3xl w-full space-y-8`}>
                                <div className="flex justify-end mb-4">
                                    <select value={language} onChange={(e) => setLanguage(e.target.value)} className={`px-4 py-2 rounded-lg border font-semibold ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-gray-100 border-gray-300'}`}>
                                        <option value="es">🇪🇸 Español</option>
                                        <option value="en">🇬🇧 English</option>
                                    </select>
                                </div>

                                <div className="text-center">
                                    <h1 className="text-5xl font-light gradient-text mb-4">✨ Lumera</h1>
                                    <p className="text-2xl font-light text-gray-700 dark:text-gray-300 mb-6">{language === 'es' ? 'Tu Compañera Personalizada' : 'Your Personalized Companion'}</p>
                                    <p className="text-lg text-gray-600 dark:text-gray-400 leading-relaxed mb-8">
                                        {language === 'es' 
                                            ? 'Entre los 40 y 55 años, tu cuerpo vive una transformación profunda. Aquí, cada cambio es natural, cada síntoma válido. Tu transformación es un acto de gracia y fortaleza que merece ser acompañado.'
                                            : 'Between 40 and 55, your body undergoes a profound transformation. Here, every change is natural, every symptom is valid. Your transformation is an act of grace and strength that deserves to be supported.'}
                                    </p>
                                </div>

                                <div className={`${darkMode ? 'bg-gray-700' : 'bg-purple-50'} rounded-xl p-8 space-y-4 border-l-4 border-purple-600`}>
                                    <h3 className="font-bold text-lg">{language === 'es' ? '✨ ¿Qué Hace Especial a Lumera?' : '✨ What Makes Lumera Special?'}</h3>
                                    <div className="space-y-3 text-sm">
                                        <p>✅ {language === 'es' ? 'Menús 7 días personalizados (4 comidas/día) - Tu nutrición única' : 'Personalized 7-day menus (4 meals/day) - Your unique nutrition'}</p>
                                        <p>✅ {language === 'es' ? 'Ejercicios según TU objetivo (Fuerza, Peso, Hormonal) con rutina semanal' : 'Exercises for YOUR goal (Strength, Weight, Hormonal) with weekly routine'}</p>
                                        <p>✅ {language === 'es' ? 'Coach permanente individual - No estás sola' : 'Personal permanent coach - You\'re not alone'}</p>
                                        <p>✅ {language === 'es' ? 'Privacidad total - Todo en tu dispositivo, sin servidores' : 'Complete privacy - Everything on your device, no servers'}</p>
                                        <p>✅ {language === 'es' ? 'Información con ciencia real - Mitos desmentidos con números' : 'Science-backed information - Myths debunked with real data'}</p>
                                        <p>✅ {language === 'es' ? 'Gráficos de tendencia - Visualiza tu evolución' : 'Trend graphs - Visualize your progress'}</p>
                                    </div>
                                </div>

                                <button onClick={() => setQuizStep(2)} className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl font-semibold hover:shadow-lg text-lg">
                                    {language === 'es' ? 'Siguiente' : 'Next'} →
                                </button>
                            </div>
                        </div>
                    );
                }

                if (quizStep === 2) {
                    return (
                        <div className={`min-h-screen ${darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-purple-100 to-pink-100'} flex items-center justify-center p-4`}>
                            <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-2xl shadow-2xl p-12 max-w-2xl w-full`}>
                                <h2 className="text-3xl font-light gradient-text mb-8">{language === 'es' ? 'Tu Perfil' : 'Your Profile'}</h2>
                                
                                <div className="space-y-4 mb-8">
                                    <input type="text" placeholder={language === 'es' ? 'Tu nombre' : 'Your name'} 
                                        value={formData.profileName}
                                        onChange={(e) => setFormData({...formData, profileName: e.target.value})}
                                        className={`w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : ''}`}/>
                                    
                                    <div className="grid grid-cols-3 gap-4">
                                        <input type="number" placeholder={language === 'es' ? 'Edad' : 'Age'} 
                                            value={formData.age}
                                            onChange={(e) => setFormData({...formData, age: e.target.value})}
                                            className={`px-4 py-3 border rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`}/>
                                        <input type="number" placeholder={language === 'es' ? 'Altura (cm)' : 'Height (cm)'} 
                                            value={formData.height}
                                            onChange={(e) => setFormData({...formData, height: e.target.value})}
                                            className={`px-4 py-3 border rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`}/>
                                        <input type="number" placeholder={language === 'es' ? 'Peso (kg)' : 'Weight (kg)'} 
                                            value={formData.weight}
                                            onChange={(e) => setFormData({...formData, weight: e.target.value})}
                                            className={`px-4 py-3 border rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`}/>
                                    </div>
                                </div>

                                <button onClick={() => setQuizStep(3)} className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg mb-4">
                                    {language === 'es' ? 'Siguiente' : 'Next'} →
                                </button>
                            </div>
                        </div>
                    );
                }

                if (quizStep === 3) {
                    const conditions = language === 'es' 
                        ? ['Diabetes', 'Hipertensión', 'Sin gluten', 'Sin lactosa', 'Vegetariana', 'Vegana', 'Artritis', 'Ansiedad']
                        : ['Diabetes', 'Hypertension', 'Gluten-free', 'Lactose-free', 'Vegetarian', 'Vegan', 'Arthritis', 'Anxiety'];
                    
                    return (
                        <div className={`min-h-screen ${darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-purple-100 to-pink-100'} flex items-center justify-center p-4`}>
                            <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-2xl shadow-2xl p-12 max-w-2xl w-full`}>
                                <h2 className="text-3xl font-light gradient-text mb-6">{language === 'es' ? 'Restricciones' : 'Restrictions'}</h2>
                                
                                <div className="grid grid-cols-2 gap-4 mb-8">
                                    {conditions.map((cond, idx) => (
                                        <label key={idx} className={`flex items-center p-4 border rounded-lg cursor-pointer transition ${
                                            formData.conditions.includes(cond)
                                                ? darkMode ? 'bg-purple-900 border-purple-600' : 'bg-purple-100 border-purple-600'
                                                : darkMode ? 'border-gray-600' : 'border-gray-300'
                                        }`}>
                                            <input type="checkbox" 
                                                checked={formData.conditions.includes(cond)}
                                                onChange={(e) => {
                                                    if (e.target.checked) {
                                                        setFormData({...formData, conditions: [...formData.conditions, cond]});
                                                    } else {
                                                        setFormData({...formData, conditions: formData.conditions.filter(c => c !== cond)});
                                                    }
                                                }}
                                                className="mr-3 w-4 h-4"/>
                                            <span>{cond}</span>
                                        </label>
                                    ))}
                                </div>

                                <button onClick={() => setQuizStep(4)} className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg">
                                    {language === 'es' ? 'Siguiente' : 'Next'} →
                                </button>
                            </div>
                        </div>
                    );
                }

                if (quizStep === 4) {
                    const goals = [
                        { value: 'strength', label: language === 'es' ? 'Ganar Fuerza' : 'Build Strength' },
                        { value: 'weightLoss', label: language === 'es' ? 'Perder Peso' : 'Lose Weight' },
                        { value: 'hormonal', label: language === 'es' ? 'Equilibrio Hormonal' : 'Hormonal Balance' }
                    ];

                    return (
                        <div className={`min-h-screen ${darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-purple-100 to-pink-100'} flex items-center justify-center p-4`}>
                            <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-2xl shadow-2xl p-12 max-w-2xl w-full`}>
                                <h2 className="text-3xl font-light gradient-text mb-8">{language === 'es' ? '¿Cuál es tu objetivo?' : 'What\'s Your Goal?'}</h2>
                                
                                <div className="space-y-4 mb-8">
                                    {goals.map((goal) => (
                                        <label key={goal.value} className={`flex items-center p-6 border-2 rounded-xl cursor-pointer transition ${
                                            exerciseGoal === goal.value
                                                ? darkMode ? 'bg-purple-900 border-purple-600' : 'bg-purple-100 border-purple-600'
                                                : darkMode ? 'border-gray-600' : 'border-gray-300'
                                        }`}>
                                            <input type="radio" name="goal" value={goal.value}
                                                checked={exerciseGoal === goal.value}
                                                onChange={(e) => setExerciseGoal(e.target.value)}
                                                className="mr-4 w-5 h-5"/>
                                            <span className="font-semibold text-lg">{goal.label}</span>
                                        </label>
                                    ))}
                                </div>

                                <button onClick={() => setQuizStep(5)} className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg">
                                    {language === 'es' ? 'Siguiente' : 'Next'} →
                                </button>
                            </div>
                        </div>
                    );
                }

                if (quizStep === 5) {
                    const regions = [
                        { value: 'LATAM', label: language === 'es' ? '🌎 Latinoamérica' : '🌎 Latin America' },
                        { value: 'EMEA', label: language === 'es' ? '🌍 Europa / África' : '🌍 Europe / Africa' },
                        { value: 'USA', label: language === 'es' ? '🌎 USA / Canadá' : '🌎 USA / Canada' }
                    ];

                    return (
                        <div className={`min-h-screen ${darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-purple-100 to-pink-100'} flex items-center justify-center p-4`}>
                            <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-2xl shadow-2xl p-12 max-w-2xl w-full`}>
                                <h2 className="text-3xl font-light gradient-text mb-4">{language === 'es' ? '¿Dónde estás?' : 'Where are you?'}</h2>
                                <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} mb-8`}>
                                    {language === 'es' 
                                        ? 'Esto nos ayuda a personalizar ingredientes locales según tu región'
                                        : 'This helps us personalize local ingredients for your region'}
                                </p>
                                
                                <div className="space-y-4 mb-8">
                                    {regions.map((region) => (
                                        <label key={region.value} className={`flex items-center p-6 border-2 rounded-xl cursor-pointer transition ${
                                            userRegion === region.value
                                                ? darkMode ? 'bg-purple-900 border-purple-600' : 'bg-purple-100 border-purple-600'
                                                : darkMode ? 'border-gray-600' : 'border-gray-300'
                                        }`}>
                                            <input type="radio" name="region" value={region.value}
                                                checked={userRegion === region.value}
                                                onChange={(e) => setUserRegion(e.target.value)}
                                                className="mr-4 w-5 h-5"/>
                                            <span className="font-semibold text-lg">{region.label}</span>
                                        </label>
                                    ))}
                                </div>

                                <button onClick={async () => {
                                    if (!formData.profileName || !formData.age || !formData.height || !formData.weight) {
                                        alert(language === 'es' ? 'Completa todos los campos' : 'Complete all fields');
                                        return;
                                    }
                                    
                                    if (!session) {
                                        alert(language === 'es' ? 'Error: No hay sesión activa. Por favor recarga la página.' : 'Error: No active session. Please reload the page.');
                                        return;
                                    }
                                    
                                    const bmi = (parseFloat(formData.weight) / ((parseFloat(formData.height) / 100) ** 2)).toFixed(1);
                                    const bmr = 10 * parseFloat(formData.weight) + 6.25 * parseFloat(formData.height) - 5 * parseInt(formData.age) + 161;
                                    const tdee = Math.round(bmr * 1.55);
                                    
                                    // GUARDAR EN SUPABASE
                                    const profileData = {
                                        profile_name: formData.profileName,
                                        age: parseInt(formData.age),
                                        height: parseFloat(formData.height),
                                        weight: parseFloat(formData.weight),
                                        health_conditions: formData.conditions,
                                        activity_level: 'moderate',
                                        goal: exerciseGoal,
                                        region: userRegion,
                                        updated_at: new Date().toISOString()
                                    };
                                    
                                    const { data: updatedProfile, error } = await supabase
                                        .from('users')
                                        .update(profileData)
                                        .eq('id', session.user.id)
                                        .select()
                                        .single();
                                    
                                    if (error) {
                                        console.error('Error guardando perfil:', error);
                                        alert(language === 'es' ? 'Error al guardar perfil' : 'Error saving profile');
                                        return;
                                    }
                                    
                                    console.log('✅ Perfil guardado en Supabase:', updatedProfile);
                                    setCurrentUser({
                                        ...updatedProfile,
                                        bmi: parseFloat(bmi),
                                        bmr: parseFloat(bmr),
                                        tdee: parseInt(tdee)
                                    });
                                    setShowQuiz(false);
                                    setCurrentPage('home');
                                }} className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg">
                                    {language === 'es' ? '¡Comenzar!' : 'Let\'s Go!'} ✨
                                </button>
                            </div>
                        </div>
                    );
                }
            };

            // LUMI - MENSAJES PERSONALIZADOS
            const getLumiMessage = (page = 'home') => {
                if (!currentUser) return null;
                
                const userName = currentUser.profile_name;
                const todaySymptoms = symptoms.length > 0 ? symptoms[symptoms.length - 1] : null;
                const yesterdaySymptoms = symptoms.length > 1 ? symptoms[symptoms.length - 2] : null;
                
                // Analizar síntomas de hoy
                const hasLowSleep = todaySymptoms && todaySymptoms.sleep <= 3;
                const hasLowEnergy = todaySymptoms && todaySymptoms.energy <= 3;
                const hasHighHotFlashes = todaySymptoms && todaySymptoms.hotFlashes >= 4;
                const hasLowMood = todaySymptoms && todaySymptoms.mood <= 3;
                
                // Mensajes según contexto
                const messages = {
                    es: {
                        home: {
                            lowSleep: `Hola ${userName}, veo que dormiste poco. Este menú te dará energía estable sin sobrecargar tu cuerpo.`,
                            lowEnergy: `${userName}, tu energía está baja hoy. Los menús de hoy te ayudarán a recuperarla sin forzarte.`,
                            highHotFlashes: `${userName}, tus sofocos están intensos. El menú de hoy tiene alimentos que pueden ayudar a calmarlos.`,
                            lowMood: `${userName}, sé que hoy es difícil. Este menú está pensado para ayudar a tu ánimo desde dentro.`,
                            default: `Hoy es un buen día para escuchar a tu cuerpo, ${userName}. No tienes que hacerlo perfecto. Solo empezar.`
                        },
                        nutrition: {
                            lowSleep: `Veo que dormiste poco, ${userName}. Este menú tiene magnesio y triptófano que pueden ayudarte a descansar mejor esta noche.`,
                            highHotFlashes: `${userName}, estos menús tienen ingredientes que muchas mujeres reportan que les ayudan con los sofocos.`,
                            default: `${userName}, cada comida es una oportunidad de darle a tu cuerpo lo que necesita en este momento.`
                        },
                        exercise: {
                            lowEnergy: `${userName}, hoy empieza suave. El movimiento ligero puede darte más energía de la que imaginas.`,
                            lowMood: `${userName}, el ejercicio puede ayudar con el ánimo. Empieza con 10 minutos y ve cómo te sientes.`,
                            default: `${userName}, tu cuerpo quiere moverse. Solo necesita que lo escuches y empieces despacio.`
                        }
                    },
                    en: {
                        home: {
                            lowSleep: `Hi ${userName}, I see you didn't sleep well. Today's menu will give you stable energy without overwhelming your body.`,
                            lowEnergy: `${userName}, your energy is low today. Today's menus will help you recover it without forcing yourself.`,
                            highHotFlashes: `${userName}, your hot flashes are intense. Today's menu has foods that may help calm them.`,
                            lowMood: `${userName}, I know today is tough. This menu is designed to help your mood from within.`,
                            default: `Today is a good day to listen to your body, ${userName}. You don't have to do it perfectly. Just start.`
                        },
                        nutrition: {
                            lowSleep: `I see you didn't sleep well, ${userName}. This menu has magnesium and tryptophan that may help you rest better tonight.`,
                            highHotFlashes: `${userName}, these menus have ingredients that many women report help with hot flashes.`,
                            default: `${userName}, every meal is an opportunity to give your body what it needs right now.`
                        },
                        exercise: {
                            lowEnergy: `${userName}, start gentle today. Light movement can give you more energy than you imagine.`,
                            lowMood: `${userName}, exercise can help with mood. Start with 10 minutes and see how you feel.`,
                            default: `${userName}, your body wants to move. It just needs you to listen and start slowly.`
                        }
                    }
                };
                
                const lang = language === 'es' ? 'es' : 'en';
                const pageMessages = messages[lang][page] || messages[lang].home;
                
                // Priorizar mensajes según síntomas
                if (hasLowSleep && pageMessages.lowSleep) return pageMessages.lowSleep;
                if (hasHighHotFlashes && pageMessages.highHotFlashes) return pageMessages.highHotFlashes;
                if (hasLowEnergy && pageMessages.lowEnergy) return pageMessages.lowEnergy;
                if (hasLowMood && pageMessages.lowMood) return pageMessages.lowMood;
                
                return pageMessages.default;
            };

            // CHAT CON LUMI
            const checkDailyLimit = () => {
                const today = new Date().toDateString();
                if (lastQuestionDate !== today) {
                    setDailyQuestions(0);
                    setLastQuestionDate(today);
                    return true;
                }
                
                const premium = isPremium();
                if (premium) return true;
                if (dailyQuestions >= 3) return false;
                return true;
            };

            const sendToLumi = async () => {
                if (!lumiInput.trim() || lumiLoading) return;
                
                // Verificar límite
                if (!checkDailyLimit()) {
                    const limitMsg = language === 'es' 
                        ? 'Has usado tus 3 preguntas diarias. Hazte premium para preguntas ilimitadas 💜'
                        : 'You\'ve used your 3 daily questions. Go premium for unlimited questions 💜';
                    setLumiMessages([...lumiMessages, { role: 'assistant', content: limitMsg }]);
                    return;
                }

                const userMessage = lumiInput.trim();
                setLumiInput('');
                setLumiMessages([...lumiMessages, { role: 'user', content: userMessage }]);
                setLumiLoading(true);

                try {
                    // Contexto de la usuaria
                    const todaySymptoms = symptoms.length > 0 ? symptoms[symptoms.length - 1] : null;
                    const userName = currentUser?.profile_name || 'amiga';
                    
                    const systemPrompt = language === 'es' 
                        ? `Eres Lumi, la coach de wellness de Lumera. Hablas con ${userName}, una mujer en esta etapa de cambios hormonales.

Tu personalidad:
- Cálida, empática, cercana (como una amiga sabia)
- Empoderador (NO victimista)
- Práctica (das consejos accionables)
- Evitas lenguaje médico técnico
- NUNCA uses la palabra "perimenopausia" o "menopausia"
- Dices "esta etapa", "este momento", "tu cuerpo ahora"

Contexto de ${userName}:
${todaySymptoms ? `- Hoy su sueño: ${todaySymptoms.sleep}/5
- Energía: ${todaySymptoms.energy}/5
- Ánimo: ${todaySymptoms.mood}/5
- Sofocos: ${todaySymptoms.hotFlashes}/5` : '- No ha registrado síntomas hoy'}

Responde en español, máximo 3-4 líneas, tono conversacional.`
                        : `You are Lumi, Lumera's wellness coach. You're talking to ${userName}, a woman going through hormonal changes.

Your personality:
- Warm, empathetic, close (like a wise friend)
- Empowering (NOT victim-focused)
- Practical (give actionable advice)
- Avoid technical medical language
- NEVER use "perimenopause" or "menopause"
- Say "this stage", "this moment", "your body now"

${userName}'s context:
${todaySymptoms ? `- Today sleep: ${todaySymptoms.sleep}/5
- Energy: ${todaySymptoms.energy}/5
- Mood: ${todaySymptoms.mood}/5
- Hot flashes: ${todaySymptoms.hotFlashes}/5` : '- No symptoms logged today'}

Respond in English, max 3-4 lines, conversational tone.`;

                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 1000,
                            system: systemPrompt,
                            messages: [
                                ...lumiMessages.filter(m => m.role !== 'assistant' || !m.content.includes('Has usado tus')),
                                { role: 'user', content: userMessage }
                            ]
                        })
                    });

                    const data = await response.json();
                    const assistantMessage = data.content[0].text;
                    
                    setLumiMessages([...lumiMessages, 
                        { role: 'user', content: userMessage },
                        { role: 'assistant', content: assistantMessage }
                    ]);
                    
                    // Incrementar contador
                    setDailyQuestions(dailyQuestions + 1);
                    
                } catch (error) {
                    console.error('Error Lumi:', error);
                    const errorMsg = language === 'es'
                        ? 'Perdona, tuve un problemita. Intenta de nuevo en un momento 💜'
                        : 'Sorry, I had a little issue. Try again in a moment 💜';
                    setLumiMessages([...lumiMessages, 
                        { role: 'user', content: userMessage },
                        { role: 'assistant', content: errorMsg }
                    ]);
                }
                
                setLumiLoading(false);
            };

            // HOME
            const renderHome = () => {
                if (!currentUser) return null;
                return (
                    <div className="pb-32 space-y-6" key={language}>
                        {/* BIENVENIDA */}
                        <div className="bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-2xl p-6 shadow-lg">
                            <h1 className="text-3xl font-light mb-2">{language === 'es' ? `¡Hola, ${currentUser.profile_name}! 💜` : `Hi, ${currentUser.profile_name}! 💜`}</h1>
                            <p className="text-base opacity-90">
                                {language === 'es' 
                                    ? 'Respira. Ya estás aquí. Eso ya cuenta.'
                                    : 'Breathe. You\'re here. That already counts.'}
                            </p>
                        </div>

                        {/* MENSAJE LUMI PERSONALIZADO */}
                        <div className={`${darkMode ? 'bg-purple-900' : 'bg-purple-50'} rounded-xl shadow p-5 border-l-4 border-purple-600`}>
                            <div className="flex items-start gap-3">
                                <span className="text-2xl">💜</span>
                                <p className={`text-sm ${darkMode ? 'text-purple-200' : 'text-purple-900'} font-medium leading-relaxed`}>
                                    {getLumiMessage('home')}
                                </p>
                            </div>
                        </div>

                        {/* CTA REGISTRAR SÍNTOMAS */}
                        <div className={`${darkMode ? 'bg-indigo-900' : 'bg-gradient-to-r from-indigo-50 to-purple-50'} rounded-xl shadow-lg p-6 border-2 border-indigo-400`}>
                            <div className="flex items-start gap-4">
                                <div className="text-4xl">📝</div>
                                <div className="flex-1">
                                    <h3 className="text-xl font-semibold gradient-text mb-2">
                                        {language === 'es' ? 'Empieza aquí' : 'Start here'}
                                    </h3>
                                    <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-4`}>
                                        {language === 'es'
                                            ? 'Cuéntale a Lumera cómo te sientes hoy. 2 minutos que marcan la diferencia.'
                                            : 'Tell Lumera how you feel today. 2 minutes that make a difference.'}
                                    </p>
                                    <button 
                                        onClick={() => setCurrentPage('symptoms')}
                                        className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transition"
                                    >
                                        {language === 'es' ? 'Registrar cómo me siento' : 'Log how I feel'}
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* FRASE ANCLA */}
                        <div className={`${darkMode ? 'bg-indigo-900' : 'bg-indigo-50'} rounded-xl shadow-lg p-6 border-l-4 border-indigo-600`}>
                            <h2 className="text-2xl font-semibold gradient-text mb-3">
                                {language === 'es' ? '🌸 Tu cuerpo está hablando' : '🌸 Your body is speaking'}
                            </h2>
                            <p className={`${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-3`}>
                                {language === 'es'
                                    ? 'Los sudores nocturnos, el insomnio, los cambios de ánimo... No son señales de alarma. Son tu cuerpo adaptándose.'
                                    : 'Night sweats, insomnia, mood changes... They\'re not alarm signals. It\'s your body adapting.'}
                            </p>
                            <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} italic`}>
                                {language === 'es'
                                    ? 'Esta etapa tiene su propio lenguaje. Lumera te ayuda a traducirlo.'
                                    : 'This stage has its own language. Lumera helps you translate it.'}
                            </p>
                        </div>

                        {/* TUS DATOS - EDITABLE */}
                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg p-6`}>
                            <div className="flex justify-between items-center mb-6">
                                <h3 className="text-xl font-semibold gradient-text">
                                    {language === 'es' ? '📊 Mis Datos Personales' : '📊 My Personal Data'}
                                </h3>
                                <button 
                                    onClick={() => setEditingProfile(!editingProfile)}
                                    className={`px-4 py-2 rounded-lg font-semibold ${editingProfile ? 'bg-gray-200 text-gray-700' : 'bg-purple-600 text-white'}`}
                                >
                                    {editingProfile ? (language === 'es' ? 'Cancelar' : 'Cancel') : (language === 'es' ? '✏️ Editar' : '✏️ Edit')}
                                </button>
                            </div>

                            {editingProfile ? (
                                <div className="space-y-4">
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-semibold mb-2">{language === 'es' ? 'Edad (años)' : 'Age (years)'}</label>
                                            <input 
                                                type="number" 
                                                value={profileEdits.age || currentUser.age}
                                                onChange={(e) => setProfileEdits({...profileEdits, age: e.target.value})}
                                                className={`w-full px-4 py-2 border rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-semibold mb-2">{language === 'es' ? 'Peso (kg)' : 'Weight (kg)'}</label>
                                            <input 
                                                type="number" 
                                                value={profileEdits.weight || currentUser.weight}
                                                onChange={(e) => setProfileEdits({...profileEdits, weight: e.target.value})}
                                                className={`w-full px-4 py-2 border rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-semibold mb-2">{language === 'es' ? 'Altura (cm)' : 'Height (cm)'}</label>
                                            <input 
                                                type="number" 
                                                value={profileEdits.height || currentUser.height}
                                                onChange={(e) => setProfileEdits({...profileEdits, height: e.target.value})}
                                                className={`w-full px-4 py-2 border rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-semibold mb-2">{language === 'es' ? 'Nivel de actividad' : 'Activity level'}</label>
                                            <select 
                                                value={profileEdits.activityLevel || currentUser.activity_level || 'moderate'}
                                                onChange={(e) => setProfileEdits({...profileEdits, activityLevel: e.target.value})}
                                                className={`w-full px-4 py-2 border rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`}
                                            >
                                                <option value="sedentary">{language === 'es' ? 'Sedentaria' : 'Sedentary'}</option>
                                                <option value="light">{language === 'es' ? 'Ligera' : 'Light'}</option>
                                                <option value="moderate">{language === 'es' ? 'Moderada' : 'Moderate'}</option>
                                                <option value="active">{language === 'es' ? 'Activa' : 'Active'}</option>
                                                <option value="very_active">{language === 'es' ? 'Muy activa' : 'Very Active'}</option>
                                            </select>
                                        </div>
                                    </div>
                                    <button 
                                        onClick={async () => {
                                            const age = parseInt(profileEdits.age || currentUser.age);
                                            const weight = parseFloat(profileEdits.weight || currentUser.weight);
                                            const height = parseFloat(profileEdits.height || currentUser.height);
                                            const activityLevel = profileEdits.activityLevel || currentUser.activity_level || 'moderate';
                                            
                                            const bmi = (weight / ((height / 100) ** 2)).toFixed(1);
                                            const bmr = 10 * weight + 6.25 * height - 5 * age + 161;
                                            const multipliers = { sedentary: 1.2, light: 1.375, moderate: 1.55, active: 1.725, very_active: 1.9 };
                                            const tdee = Math.round(bmr * (multipliers[activityLevel] || 1.55));
                                            
                                            // ACTUALIZAR EN LOCALSTORAGE
                                            const updatedUser = {
                                                ...currentUser,
                                                age: age,
                                                weight: weight,
                                                height: height,
                                                activity_level: activityLevel,
                                                bmi: parseFloat(bmi),
                                                bmr: parseFloat(bmr),
                                                tdee: tdee
                                            };
                                            
                                            setCurrentUser(updatedUser);
                                            localStorage.setItem('lumeraUser', JSON.stringify(updatedUser));
                                            
                                            // Actualizar en registro de usuarios
                                            const users = JSON.parse(localStorage.getItem('lumeraUsers') || '{}');
                                            if (users[currentUser.email]) {
                                                users[currentUser.email].profile = updatedUser;
                                                localStorage.setItem('lumeraUsers', JSON.stringify(users));
                                            }
                                            
                                            setEditingProfile(false);
                                            setProfileEdits({});
                                            alert(language === 'es' ? '✅ Datos actualizados correctamente' : '✅ Data updated successfully');
                                        }}
                                        className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-semibold"
                                    >
                                        {language === 'es' ? 'Guardar cambios' : 'Save changes'}
                                    </button>
                                </div>
                            ) : (
                                <div className="grid md:grid-cols-2 gap-4">
                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} rounded-lg p-4`}>
                                        <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} mb-1`}>{language === 'es' ? 'Edad' : 'Age'}</p>
                                        <p className="text-xl font-bold">{currentUser.age} {language === 'es' ? 'años' : 'years'}</p>
                                    </div>
                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} rounded-lg p-4`}>
                                        <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} mb-1`}>{language === 'es' ? 'Peso' : 'Weight'}</p>
                                        <p className="text-xl font-bold">{currentUser.weight} kg</p>
                                    </div>
                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} rounded-lg p-4`}>
                                        <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} mb-1`}>{language === 'es' ? 'Altura' : 'Height'}</p>
                                        <p className="text-xl font-bold">{currentUser.height} cm</p>
                                    </div>
                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} rounded-lg p-4`}>
                                        <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} mb-1`}>{language === 'es' ? 'Actividad' : 'Activity'}</p>
                                        <p className="text-xl font-bold capitalize">{currentUser.activity_level || 'moderate'}</p>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* PERFIL METABÓLICO CON DESPLEGABLES */}
                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg p-6`}>
                            <h3 className="text-xl font-semibold gradient-text mb-4">
                                {language === 'es' ? '💪 Tu Perfil Metabólico' : '💪 Your Metabolic Profile'}
                            </h3>
                            
                            <div className="space-y-4">
                                {/* IMC */}
                                <div className={`${darkMode ? 'bg-gray-700' : 'bg-purple-50'} rounded-lg p-4`}>
                                    <div className="flex justify-between items-center mb-2">
                                        <div>
                                            <p className="text-sm font-semibold">{language === 'es' ? 'IMC (Índice de Masa Corporal)' : 'BMI (Body Mass Index)'}</p>
                                            <p className="text-3xl font-bold gradient-text">{currentUser.bmi}</p>
                                        </div>
                                        <button 
                                            onClick={() => setShowBmiInfo(!showBmiInfo)}
                                            className="text-2xl text-purple-600 hover:text-purple-800"
                                        >
                                            ℹ️
                                        </button>
                                    </div>
                                    {showBmiInfo && (
                                        <div className={`mt-3 p-3 ${darkMode ? 'bg-gray-600' : 'bg-white'} rounded text-sm`}>
                                            {language === 'es' 
                                                ? 'Es una medida que relaciona tu peso con tu altura. Te ayuda a saber si estás en un rango saludable. Entre 18.5 y 24.9 se considera normal, pero recuerda: es solo una referencia, no define tu salud completa.'
                                                : 'It\'s a measure that relates your weight to your height. It helps you know if you\'re in a healthy range. Between 18.5 and 24.9 is considered normal, but remember: it\'s just a reference, it doesn\'t define your complete health.'}
                                        </div>
                                    )}
                                </div>

                                {/* TMB */}
                                <div className={`${darkMode ? 'bg-gray-700' : 'bg-pink-50'} rounded-lg p-4`}>
                                    <div className="flex justify-between items-center mb-2">
                                        <div>
                                            <p className="text-sm font-semibold">{language === 'es' ? 'TMB (Tasa Metabólica Basal)' : 'BMR (Basal Metabolic Rate)'}</p>
                                            <p className="text-3xl font-bold text-pink-600">{Math.round(currentUser.bmr)} kcal/día</p>
                                        </div>
                                        <button 
                                            onClick={() => setShowBmrInfo(!showBmrInfo)}
                                            className="text-2xl text-pink-600 hover:text-pink-800"
                                        >
                                            ℹ️
                                        </button>
                                    </div>
                                    {showBmrInfo && (
                                        <div className={`mt-3 p-3 ${darkMode ? 'bg-gray-600' : 'bg-white'} rounded text-sm`}>
                                            {language === 'es'
                                                ? 'Es la energía que tu cuerpo necesita para funcionar en reposo: respirar, pensar, mantener tu temperatura. Es como el "consumo mínimo" de tu cuerpo.'
                                                : 'It\'s the energy your body needs to function at rest: breathing, thinking, maintaining your temperature. It\'s like your body\'s "minimum consumption".'}
                                        </div>
                                    )}
                                </div>

                                {/* TDEE */}
                                <div className={`${darkMode ? 'bg-gray-700' : 'bg-blue-50'} rounded-lg p-4`}>
                                    <div className="flex justify-between items-center mb-2">
                                        <div>
                                            <p className="text-sm font-semibold">{language === 'es' ? 'TDEE (Gasto Energético Total)' : 'TDEE (Total Daily Energy Expenditure)'}</p>
                                            <p className="text-3xl font-bold text-blue-600">{currentUser.tdee} kcal/día</p>
                                        </div>
                                        <button 
                                            onClick={() => setShowTdeeInfo(!showTdeeInfo)}
                                            className="text-2xl text-blue-600 hover:text-blue-800"
                                        >
                                            ℹ️
                                        </button>
                                    </div>
                                    {showTdeeInfo && (
                                        <div className={`mt-3 p-3 ${darkMode ? 'bg-gray-600' : 'bg-white'} rounded text-sm`}>
                                            {language === 'es'
                                                ? 'Es tu TMB más las calorías que quemas con tu actividad diaria. Esto te indica cuánta energía necesitas al día para mantener tu peso actual.'
                                                : 'It\'s your BMR plus the calories you burn with your daily activity. This tells you how much energy you need per day to maintain your current weight.'}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>

                        {/* TUTORIAL DESPLEGABLE */}
                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow p-6`}>
                            <button 
                                onClick={() => setShowTutorial(!showTutorial)}
                                className="w-full flex items-center justify-between text-left"
                            >
                                <h3 className="text-xl font-semibold gradient-text">
                                    {language === 'es' ? '📖 Cómo usar Lumera' : '📖 How to use Lumera'}
                                </h3>
                                <span className="text-2xl">{showTutorial ? '−' : '+'}</span>
                            </button>
                            
                            {showTutorial && (
                                <div className="mt-6 space-y-4">
                                    <div className="flex gap-3">
                                        <div className="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full flex items-center justify-center text-white font-bold">1</div>
                                        <div>
                                            <h4 className="font-bold mb-1">{language === 'es' ? '🥗 Revisa tu menú' : '🥗 Check your menu'}</h4>
                                            <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                                                {language === 'es' 
                                                    ? 'Cada semana tienes 4 comidas diarias adaptadas a tus restricciones y región.'
                                                    : 'Each week you get 4 daily meals adapted to your restrictions and region.'}
                                            </p>
                                        </div>
                                    </div>

                                    <div className="flex gap-3">
                                        <div className="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full flex items-center justify-center text-white font-bold">2</div>
                                        <div>
                                            <h4 className="font-bold mb-1">{language === 'es' ? '📝 Registra cómo te sientes' : '📝 Log how you feel'}</h4>
                                            <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                                                {language === 'es' 
                                                    ? '2 minutos diarios. Verás patrones en gráficos que puedes compartir con tu médico.'
                                                    : '2 minutes daily. You\'ll see patterns in graphs you can share with your doctor.'}
                                            </p>
                                        </div>
                                    </div>

                                    <div className="flex gap-3">
                                        <div className="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full flex items-center justify-center text-white font-bold">3</div>
                                        <div>
                                            <h4 className="font-bold mb-1">{language === 'es' ? '💪 Sigue tus ejercicios' : '💪 Follow your exercises'}</h4>
                                            <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                                                {language === 'es' 
                                                    ? 'Rutina personalizada según tu objetivo (Fuerza, Peso, Equilibrio Hormonal).'
                                                    : 'Personalized routine based on your goal (Strength, Weight Loss, Hormonal Balance).'}
                                            </p>
                                        </div>
                                    </div>

                                    <div className="flex gap-3">
                                        <div className="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full flex items-center justify-center text-white font-bold">4</div>
                                        <div>
                                            <h4 className="font-bold mb-1">{language === 'es' ? '💜 Usa los recursos' : '💜 Use the resources'}</h4>
                                            <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                                                {language === 'es' 
                                                    ? 'Mitos desmontados con ciencia y consejos prácticos en las pestañas de abajo.'
                                                    : 'Myths debunked with science and practical advice in the tabs below.'}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* PARA QUIÉN NO ES LUMERA */}
                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-yellow-50'} rounded-xl shadow p-6 border-l-4 border-yellow-600`}>
                            <h3 className="font-bold text-lg mb-3">
                                ⚠️ {language === 'es' ? 'Lumera no es para ti si buscas:' : 'Lumera is not for you if you seek:'}
                            </h3>
                            <ul className={`space-y-2 text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                <li>• {language === 'es' ? 'Dietas milagro' : 'Miracle diets'}</li>
                                <li>• {language === 'es' ? 'Resultados en 7 días' : 'Results in 7 days'}</li>
                                <li>• {language === 'es' ? 'Soluciones mágicas' : 'Magic solutions'}</li>
                            </ul>
                            <p className={`mt-3 text-sm font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-900'}`}>
                                {language === 'es'
                                    ? 'Lumera es para mujeres que quieren entenderse, no arreglarse rápido.'
                                    : 'Lumera is for women who want to understand themselves, not fix themselves quickly.'}
                            </p>
                        </div>

                        {/* CTA PREMIUM EMPÁTICO (si es free) */}
                        {!isPremium() && (
                            <div className={`${darkMode ? 'bg-gradient-to-br from-purple-900 to-pink-900' : 'bg-gradient-to-br from-purple-50 to-pink-50'} rounded-2xl shadow-xl p-8 border-2 ${darkMode ? 'border-purple-700' : 'border-purple-200'}`}>
                                <div className="text-center mb-6">
                                    <div className="inline-block p-4 bg-gradient-to-br from-purple-100 to-pink-100 rounded-full mb-4">
                                        <svg className="w-12 h-12 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                        </svg>
                                    </div>
                                    <h3 className="text-2xl font-semibold gradient-text mb-3">
                                        {language === 'es' ? '¿Lista para priorizarte?' : 'Ready to put yourself first?'}
                                    </h3>
                                    <p className={`text-lg ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-4 leading-relaxed max-w-xl mx-auto`}>
                                        {language === 'es'
                                            ? 'Has probado el lunes. Ahora imagina tener esto toda la semana. Menús completos, rutinas personalizadas, y Lumi acompañándote cada día.'
                                            : 'You\'ve tried Monday. Now imagine having this all week. Complete menus, personalized routines, and Lumi with you every day.'}
                                    </p>
                                </div>

                                <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl p-6 mb-6 shadow-lg`}>
                                    <h4 className="font-bold text-lg mb-4 gradient-text">
                                        {language === 'es' ? '💜 Con Lumera Premium:' : '💜 With Lumera Premium:'}
                                    </h4>
                                    <div className="space-y-3 text-sm">
                                        <div className="flex items-start gap-3">
                                            <span className="text-2xl">🍽️</span>
                                            <div>
                                                <p className="font-semibold">{language === 'es' ? 'Menús 7 días completos' : 'Complete 7-day menus'}</p>
                                                <p className={darkMode ? 'text-gray-400' : 'text-gray-600'}>
                                                    {language === 'es' ? '28 recetas semanales adaptadas a ti' : '28 weekly recipes adapted to you'}
                                                </p>
                                            </div>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <span className="text-2xl">💪</span>
                                            <div>
                                                <p className="font-semibold">{language === 'es' ? 'Rutinas completas semanales' : 'Complete weekly routines'}</p>
                                                <p className={darkMode ? 'text-gray-400' : 'text-gray-600'}>
                                                    {language === 'es' ? 'Ejercicios para tu objetivo específico' : 'Exercises for your specific goal'}
                                                </p>
                                            </div>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <span className="text-2xl">🤖</span>
                                            <div>
                                                <p className="font-semibold">{language === 'es' ? 'Lumi, tu coach personal' : 'Lumi, your personal coach'}</p>
                                                <p className={darkMode ? 'text-gray-400' : 'text-gray-600'}>
                                                    {language === 'es' ? 'Evoluciona contigo y recuerda tu historial' : 'Evolves with you and remembers your history'}
                                                </p>
                                            </div>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <span className="text-2xl">📊</span>
                                            <div>
                                                <p className="font-semibold">{language === 'es' ? 'PDFs para tu doctora' : 'PDFs for your doctor'}</p>
                                                <p className={darkMode ? 'text-gray-400' : 'text-gray-600'}>
                                                    {language === 'es' ? 'Reportes profesionales de tus síntomas' : 'Professional reports of your symptoms'}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="text-center">
                                    <button 
                                        onClick={handleSubscribe}
                                        className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-10 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transition transform hover:scale-105"
                                    >
                                        💜 {language === 'es' ? 'Priorízate este mes' : 'Put yourself first this month'}
                                    </button>
                                    <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} mt-4`}>
                                        {language === 'es' ? '€4.99/mes · Cancela cuando quieras · Sin compromisos' : '€4.99/month · Cancel anytime · No commitments'}
                                    </p>
                                    <p className={`text-xs ${darkMode ? 'text-gray-500' : 'text-gray-500'} mt-2 italic`}>
                                        {language === 'es' ? 'Menos que un café al día' : 'Less than a coffee a day'}
                                    </p>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // NUTRICIÓN
            const renderNutrition = () => {
                console.log('📍 renderNutrition llamado');
                const daysOrder = ['lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado', 'domingo'];
                const daysLabels = language === 'es' ? ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'] : ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                const mealLabels = language === 'es' ? { Desayuno: 'Desayuno', Almuerzo: 'Almuerzo', Cena: 'Cena', Snack: 'Snack' } : { Desayuno: 'Breakfast', Almuerzo: 'Lunch', Cena: 'Dinner', Snack: 'Snack' };
                const menus = getWeekMenus();
                const premium = isPremium();
                
                console.log('🍽️ MENÚ DEBUG:', { 
                    premium, 
                    menusExist: !!menus,
                    menusEsExist: !!menus?.es,
                    lunesRecipes: menus?.es?.lunes?.length,
                    currentUser: !!currentUser,
                    language 
                });

                return (
                    <div className="pb-32 space-y-8" key={`nutrition-${language}`}>
                        <h2 className="text-3xl font-light gradient-text">{t[language].nutrition}</h2>

                        {/* MENSAJE LUMI PERSONALIZADO NUTRICIÓN */}
                        <div className={`${darkMode ? 'bg-purple-900' : 'bg-purple-50'} rounded-xl shadow p-5 border-l-4 border-purple-600`}>
                            <div className="flex items-start gap-3">
                                <span className="text-2xl">💜</span>
                                <p className={`text-sm ${darkMode ? 'text-purple-200' : 'text-purple-900'} font-medium leading-relaxed`}>
                                    {getLumiMessage('nutrition')}
                                </p>
                            </div>
                        </div>

                        {daysOrder.map((day, dayIdx) => {
                            const recipes = menus[language === 'es' ? 'es' : 'en'][day] || [];
                            const isLocked = dayIdx > 0; // FORZADO: Solo día 1 gratis SIEMPRE
                            
                            console.log(`Día ${dayIdx} (${day}): ${recipes.length} recetas, locked=${isLocked}`);
                            
                            // Si es día 1 (Lunes), mostrar completo
                            if (dayIdx === 0) {
                                return (
                                    <div key={day} className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-2xl shadow-lg overflow-hidden`}>
                                        <div className="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-6">
                                            <h3 className="text-2xl font-semibold">📅 {daysLabels[dayIdx]} ✨</h3>
                                        </div>
                                        
                                        <div className="p-8 space-y-6">
                                            {recipes.map((recipe, idx) => (
                                                <div key={idx} className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} rounded-xl p-6 border-l-4 border-purple-600`}>
                                                    <div className="flex justify-between items-start mb-4">
                                                        <div className="flex-1">
                                                            <h4 className="text-xl font-semibold mb-1">{recipe.name}</h4>
                                                            <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} mb-2`}>{mealLabels[recipe.meal] || recipe.meal}</p>
                                                            {recipe.horario && (
                                                                <div className={`${darkMode ? 'bg-blue-900' : 'bg-blue-100'} inline-block px-3 py-1 rounded-lg`}>
                                                                    <p className={`text-xs font-semibold ${darkMode ? 'text-blue-200' : 'text-blue-800'}`}>
                                                                        🕐 {recipe.horario}
                                                                    </p>
                                                                </div>
                                                            )}
                                                        </div>
                                                        <span className={`${darkMode ? 'bg-gray-600' : 'bg-purple-100'} text-purple-700 px-3 py-1 rounded-lg text-sm font-semibold`}>{recipe.calories} cal</span>
                                                    </div>
                                                    
                                                    {recipe.whyHorario && (
                                                        <div className={`${darkMode ? 'bg-indigo-900' : 'bg-indigo-50'} p-3 rounded-lg mb-4 border-l-2 border-indigo-500`}>
                                                            <p className={`text-xs ${darkMode ? 'text-indigo-200' : 'text-indigo-900'} leading-relaxed`}>
                                                                ⏰ <strong>Por qué ahora:</strong> {recipe.whyHorario}
                                                            </p>
                                                        </div>
                                                    )}

                                                    <div className="grid md:grid-cols-2 gap-6 mb-4">
                                                        <div>
                                                            <h5 className="font-semibold mb-3">✓ {t[language].ingredients}</h5>
                                                            <div className="space-y-3 text-sm">
                                                                {recipe.ingredients.map((ing, i) => {
                                                                    // Determinar nombre del ingrediente según región
                                                                    const regionKey = userRegion.toLowerCase(); // 'latam', 'emea', 'usa'
                                                                    const displayName = ing.region?.[regionKey] || ing.name;
                                                                    
                                                                    return (
                                                                        <div key={i} className="pb-3 border-b border-gray-100">
                                                                            <p className="font-medium text-gray-900 dark:text-white mb-1">
                                                                                {displayName}: <span className="text-purple-600 font-bold">{ing.qty}{ing.unit}</span>
                                                                            </p>
                                                                            <p className={`text-sm ${darkMode ? 'text-green-300' : 'text-green-700'} mb-2 leading-relaxed font-medium`}>
                                                                                💚 {ing.why}
                                                                            </p>
                                                                            {ing.eco && ing.gourmet && (
                                                                                <div className="flex gap-2 text-xs flex-wrap">
                                                                                    <span className={`${darkMode ? 'bg-blue-900 text-blue-200' : 'bg-blue-100 text-blue-800'} px-2 py-1 rounded`}>
                                                                                        💰 {ing.eco}
                                                                                    </span>
                                                                                    <span className={`${darkMode ? 'bg-purple-900 text-purple-200' : 'bg-purple-100 text-purple-800'} px-2 py-1 rounded`}>
                                                                                        ✨ {ing.gourmet}
                                                                                    </span>
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                    );
                                                                })}
                                                            </div>
                                                        </div>

                                                        <div>
                                                            <h5 className="font-semibold mb-3">👨‍🍳 {t[language].preparation}</h5>
                                                            <ol className="space-y-1 text-sm">
                                                                {recipe.steps.map((step, i) => (
                                                                    <li key={i}>✓ {step}</li>
                                                                ))}
                                                            </ol>
                                                        </div>
                                                    </div>

                                                    <div className={`p-3 rounded-lg ${darkMode ? 'bg-gray-600' : 'bg-blue-50'} border-l-2 border-blue-500`}>
                                                        <p className={`text-sm font-semibold ${darkMode ? 'text-blue-300' : 'text-blue-900'}`}>💡 {t[language].why}: {recipe.why}</p>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            );
                            }
                            
                            // Si es día 2 (Martes), mostrar paywall único para resto de semana
                            if (dayIdx === 1) {
                                return (
                                    <div key="rest-of-week" className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-2xl shadow-lg overflow-hidden`}>
                                        <div className="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-6">
                                            <h3 className="text-2xl font-semibold">📅 {language === 'es' ? 'Martes a Domingo' : 'Tuesday to Sunday'} 🔒</h3>
                                        </div>

                                        <div className="p-12 text-center">
                                            <div className="mb-6">
                                                <div className="inline-block p-6 bg-gradient-to-br from-purple-100 to-pink-100 rounded-full mb-4">
                                                    <svg className="w-16 h-16 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                                    </svg>
                                                </div>
                                            </div>
                                            <h3 className="text-2xl font-semibold gradient-text mb-3">
                                                {language === 'es' ? 'Sigue Mimándote Toda la Semana' : 'Keep Taking Care of Yourself All Week'}
                                            </h3>
                                            <p className={`text-lg ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-6 max-w-md mx-auto leading-relaxed`}>
                                                {language === 'es'
                                                    ? 'Has probado el lunes. Ahora imagina tener menús personalizados, adaptados a ti, todos los días. Tu cuerpo te lo agradecerá.'
                                                    : 'You\'ve tried Monday. Now imagine having personalized menus, tailored to you, every day. Your body will thank you.'}
                                            </p>
                                            <button 
                                                onClick={handleSubscribe}
                                                className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-4 rounded-xl font-semibold text-lg hover:shadow-xl transition transform hover:scale-105"
                                            >
                                                💜 {language === 'es' ? 'Priorízate Este Mes' : 'Put Yourself First This Month'}
                                            </button>
                                            <p className={`text-xs ${darkMode ? 'text-gray-500' : 'text-gray-500'} mt-4`}>
                                                {language === 'es' ? '€4.99/mes · Cancela cuando quieras · Sin compromisos' : '€4.99/month · Cancel anytime · No commitments'}
                                            </p>
                                        </div>
                                    </div>
                                );
                            }
                            
                            // Para días 3-7, no renderizar nada (ya mostramos el paywall en día 2)
                            return null;
                        })}
                    </div>
                );
            };

            // EJERCICIOS
            const renderExercise = () => {
                const exercises = getExercises();
                const objectives = { strength: language === 'es' ? '💪 Ganar Fuerza' : '💪 Build Strength', weightLoss: language === 'es' ? '⚡ Perder Peso' : '⚡ Lose Weight', hormonal: language === 'es' ? '🧘 Equilibrio Hormonal' : '🧘 Hormonal Balance' };
                const premium = isPremium();
                const previewCount = 3; // Solo 3 ejercicios gratis
                
                console.log('💪 EJERCICIOS DEBUG:', { 
                    premium, 
                    totalExercises: exercises.length,
                    showing: premium ? exercises.length : previewCount 
                });

                return (
                    <div className="pb-32 space-y-8" key={`exercise-${language}`}>
                        <div>
                            <h2 className="text-3xl font-light gradient-text">{t[language].exercise}</h2>
                            <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>{objectives[exerciseGoal]}</p>
                        </div>

                        {/* MENSAJE LUMI PERSONALIZADO EJERCICIO */}
                        <div className={`${darkMode ? 'bg-purple-900' : 'bg-purple-50'} rounded-xl shadow p-5 border-l-4 border-purple-600`}>
                            <div className="flex items-start gap-3">
                                <span className="text-2xl">💜</span>
                                <p className={`text-sm ${darkMode ? 'text-purple-200' : 'text-purple-900'} font-medium leading-relaxed`}>
                                    {getLumiMessage('exercise')}
                                </p>
                            </div>
                        </div>

                        <div className="flex gap-4 overflow-x-auto pb-4">
                            {['strength', 'weightLoss', 'hormonal'].map((goal) => (
                                <button key={goal} onClick={() => setExerciseGoal(goal)} className={`px-6 py-3 rounded-lg font-semibold whitespace-nowrap transition ${exerciseGoal === goal ? 'bg-purple-600 text-white' : darkMode ? 'bg-gray-800 text-gray-300' : 'bg-gray-200 text-gray-700'}`}>
                                    {goal === 'strength' ? t[language].strength : goal === 'weightLoss' ? t[language].weightLoss : t[language].hormonal}
                                </button>
                            ))}
                        </div>

                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-blue-50'} rounded-xl p-6 border-l-4 border-blue-600 mb-6`}>
                            <h3 className={`font-bold mb-3 ${darkMode ? 'text-blue-300' : 'text-blue-900'}`}>📅 {language === 'es' ? 'Tu Rutina Semanal' : 'Your Weekly Routine'}</h3>
                            <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                {language === 'es' 
                                    ? 'Esta rutina está diseñada para tu objetivo. Cada ejercicio tiene ciencia detrás.'
                                    : 'This routine is designed for your goal. Each exercise is science-backed.'}
                            </p>
                        </div>

                        <div className="space-y-6">
                            {exercises.slice(0, previewCount).map((ex, idx) => (
                                <div key={idx} className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg overflow-hidden`}>
                                    <div className="bg-gradient-to-r from-green-500 to-emerald-600 text-white p-6">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <h3 className="text-2xl font-semibold mb-2">{ex.name}</h3>
                                                <div className="flex gap-4 text-sm flex-wrap">
                                                    <span>⏱ {ex.duration}</span>
                                                    <span>💪 {ex.difficulty}</span>
                                                    <span>📅 {ex.freq}</span>
                                                    <span className="bg-white bg-opacity-20 px-3 py-1 rounded-lg">📆 {ex.day}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="p-6 space-y-4">
                                        <div className={`${darkMode ? 'bg-gray-700' : 'bg-yellow-50'} p-4 rounded-lg border-l-4 border-yellow-500`}>
                                            <p className={`text-sm font-semibold mb-2 ${darkMode ? 'text-yellow-300' : 'text-yellow-900'}`}>💡 {t[language].why}:</p>
                                            <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>{ex.why}</p>
                                        </div>

                                        <div className={`${darkMode ? 'bg-gray-700' : 'bg-blue-50'} p-4 rounded-lg border-l-4 border-blue-600`}>
                                            <p className={`text-sm font-semibold mb-2 ${darkMode ? 'text-blue-300' : 'text-blue-900'}`}>🔬 {language === 'es' ? 'Base Científica' : 'Science'}:</p>
                                            <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>{ex.science}</p>
                                        </div>
                                        
                                        <div className={`${darkMode ? 'bg-gray-700' : 'bg-green-50'} p-4 rounded-lg border-l-4 border-green-600`}>
                                            <p className={`text-sm font-semibold mb-3 ${darkMode ? 'text-green-300' : 'text-green-900'}`}>📋 {language === 'es' ? 'Cómo Hacerlo Paso a Paso' : 'Step-by-Step Instructions'}:</p>
                                            {Array.isArray(ex.steps) && ex.steps.length > 0 ? (
                                                <ol className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'} space-y-3 list-decimal list-outside ml-5`}>
                                                    {ex.steps.map((step, i) => (
                                                        <li key={i} className="pl-2 leading-relaxed">{step}</li>
                                                    ))}
                                                </ol>
                                            ) : (
                                                <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} italic`}>
                                                    {language === 'es' ? 'Consulta con un entrenador para técnica correcta' : 'Consult a trainer for proper technique'}
                                                </p>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            ))}

                            {exercises.length > previewCount && (
                                <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-2xl shadow-lg p-12 text-center`}>
                                    <div className="mb-6">
                                        <div className="inline-block p-6 bg-gradient-to-br from-green-100 to-emerald-100 rounded-full mb-4">
                                            <svg className="w-16 h-16 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                            </svg>
                                        </div>
                                    </div>
                                    <h3 className="text-2xl font-semibold gradient-text mb-3">
                                        {language === 'es' ? 'Tu cuerpo merece un plan completo' : 'Your body deserves a complete plan'}
                                    </h3>
                                    <p className={`text-lg ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-6 max-w-md mx-auto leading-relaxed`}>
                                        {language === 'es'
                                            ? `Tienes ${exercises.length - previewCount} ejercicios más esperándote. Una rutina semanal completa, adaptada a lo que necesitas ahora.`
                                            : `You have ${exercises.length - previewCount} more exercises waiting. A complete weekly routine, adapted to what you need now.`}
                                    </p>
                                    <button 
                                        onClick={handleSubscribe}
                                        className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-4 rounded-xl font-semibold text-lg hover:shadow-xl transition"
                                    >
                                        💜 {language === 'es' ? 'Priorízate este mes' : 'Put yourself first this month'}
                                    </button>
                                    <p className={`text-xs ${darkMode ? 'text-gray-500' : 'text-gray-500'} mt-4`}>
                                        {language === 'es' ? '€4.99/mes · Cancela cuando quieras' : '€4.99/month · Cancel anytime'}
                                    </p>
                                </div>
                            )}
                        </div>

                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg p-6`}>
                            <h3 className="font-bold text-lg mb-4">💜 {language === 'es' ? 'Consejos para Éxito' : 'Tips for Success'}</h3>
                            <ul className="space-y-3 text-sm">
                                <li>✅ {language === 'es' ? 'Sigue tu rutina 3-4 meses antes de cambiar' : 'Follow your routine for 3-4 months before changing'}</li>
                                <li>✅ {language === 'es' ? 'Escucha tu cuerpo - Descansa si necesitas' : 'Listen to your body - Rest if needed'}</li>
                                <li>✅ {language === 'es' ? 'Calienta antes y estira después' : 'Warm up before, stretch after'}</li>
                                <li>✅ {language === 'es' ? 'Consistencia > intensidad' : 'Consistency > intensity'}</li>
                            </ul>
                        </div>
                    </div>
                );
            };

            // SÍNTOMAS
            const renderSymptoms = () => {
                return (
                    <div className="pb-32 space-y-8" key={`symptoms-${language}`}>
                        <h2 className="text-3xl font-light gradient-text">{t[language].symptoms}</h2>
                        
                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg p-6 space-y-6`}>
                            <h3 className="font-semibold text-lg">{language === 'es' ? 'Registra tu día' : 'Track your day'}</h3>
                            
                            <div className="space-y-4">
                                {[
                                    { key: 'sleep', label: language === 'es' ? 'Calidad del sueño' : 'Sleep quality', emoji: '😴' },
                                    { key: 'energy', label: language === 'es' ? 'Nivel de energía' : 'Energy level', emoji: '⚡' },
                                    { key: 'mood', label: language === 'es' ? 'Ánimo' : 'Mood', emoji: '😊' },
                                    { key: 'hotFlashes', label: language === 'es' ? 'Sofocos' : 'Hot flashes', emoji: '🔥' },
                                    { key: 'anxiety', label: language === 'es' ? 'Ansiedad' : 'Anxiety', emoji: '😰' }
                                ].map((item) => (
                                    <div key={item.key}>
                                        <div className="flex justify-between mb-2">
                                            <label className="text-sm font-semibold">{item.emoji} {item.label}</label>
                                            <span className="text-purple-600 font-bold">{symptomForm[item.key]}/10</span>
                                        </div>
                                        <input type="range" min="0" max="10" value={symptomForm[item.key]} onChange={(e) => setSymptomForm({...symptomForm, [item.key]: parseInt(e.target.value)})} className="w-full accent-purple-600"/>
                                    </div>
                                ))}

                                <div>
                                    <label className="block text-sm font-semibold mb-2">{language === 'es' ? 'Fecha' : 'Date'}</label>
                                    <input type="date" value={symptomForm.date} onChange={(e) => setSymptomForm({...symptomForm, date: e.target.value})} className={`w-full px-4 py-2 border rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`}/>
                                </div>
                            </div>

                            <button onClick={() => {
                                setSymptoms([...symptoms, symptomForm]);
                                setSymptomForm({ sleep: 5, energy: 5, mood: 5, hotFlashes: 0, anxiety: 5, date: new Date().toISOString().split('T')[0] });
                                // Mostrar notificación personalizada
                                const notification = document.createElement('div');
                                notification.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-4 rounded-xl shadow-2xl z-50 max-w-md';
                                notification.innerHTML = `
                                    <div class="flex items-start gap-3">
                                        <div class="text-3xl">💜</div>
                                        <div>
                                            <p class="font-bold mb-1">${language === 'es' ? '¡Síntoma registrado!' : 'Symptom recorded!'}</p>
                                            <p class="text-sm opacity-90">${language === 'es' ? 'Gracias. Esto me ayuda a acompañarte mejor. Tu menú te está esperando en 🥗 Nutrición' : 'Thank you. This helps me support you better. Your menu is waiting in 🥗 Nutrition'}</p>
                                        </div>
                                    </div>
                                `;
                                document.body.appendChild(notification);
                                setTimeout(() => notification.remove(), 5000);
                            }} className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg">
                                {t[language].addRecord}
                            </button>
                        </div>

                        {symptoms.length > 0 && (
                            <>
                                <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg p-6`}>
                                    <h3 className="font-semibold text-lg mb-4">📈 {language === 'es' ? 'Tendencia de Sueño' : 'Sleep Trend'}</h3>
                                    <canvas ref={chartRefSleep} style={{maxHeight: '300px'}}></canvas>
                                </div>

                                <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg p-6`}>
                                    <h3 className="font-semibold text-lg mb-4">📈 {language === 'es' ? 'Tendencia de Energía' : 'Energy Trend'}</h3>
                                    <canvas ref={chartRefEnergy} style={{maxHeight: '300px'}}></canvas>
                                </div>

                                <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg p-6`}>
                                    <h3 className="font-semibold text-lg mb-4">📈 {language === 'es' ? 'Tendencia de Ánimo' : 'Mood Trend'}</h3>
                                    <canvas ref={chartRefMood} style={{maxHeight: '300px'}}></canvas>
                                </div>

                                <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg p-6`}>
                                    <h3 className="font-semibold text-lg mb-4">📈 {language === 'es' ? 'Tendencia de Sofocos' : 'Hot Flashes Trend'}</h3>
                                    <canvas ref={chartRefHotFlashes} style={{maxHeight: '300px'}}></canvas>
                                </div>

                                <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg p-6`}>
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="font-semibold text-lg">📊 {language === 'es' ? 'Resumen General' : 'Overall Summary'}</h3>
                                        <button onClick={async () => {
                                            const { jsPDF } = window.jspdf;
                                            const doc = new jsPDF();
                                            
                                            doc.setFontSize(20);
                                            doc.text('Lumera - Reporte de Síntomas', 20, 20);
                                            
                                            doc.setFontSize(12);
                                            doc.text(`${language === 'es' ? 'Usuaria' : 'User'}: ${currentUser.profile_name}`, 20, 40);
                                            doc.text(`${language === 'es' ? 'Fecha' : 'Date'}: ${new Date().toLocaleDateString()}`, 20, 50);
                                            
                                            const avgSleep = (symptoms.reduce((a, s) => a + s.sleep, 0) / symptoms.length).toFixed(1);
                                            const avgEnergy = (symptoms.reduce((a, s) => a + s.energy, 0) / symptoms.length).toFixed(1);
                                            const avgMood = (symptoms.reduce((a, s) => a + s.mood, 0) / symptoms.length).toFixed(1);
                                            
                                            doc.setFontSize(14);
                                            doc.text(language === 'es' ? 'Promedios' : 'Averages', 20, 70);
                                            doc.setFontSize(11);
                                            doc.text(`${language === 'es' ? 'Sueño' : 'Sleep'}: ${avgSleep}/10`, 20, 85);
                                            doc.text(`${language === 'es' ? 'Energía' : 'Energy'}: ${avgEnergy}/10`, 20, 95);
                                            doc.text(`${language === 'es' ? 'Ánimo' : 'Mood'}: ${avgMood}/10`, 20, 105);
                                            
                                            doc.text(`${language === 'es' ? 'Total de registros' : 'Total records'}: ${symptoms.length}`, 20, 120);
                                            
                                            doc.save(`Lumera_Sintomas_${new Date().toISOString().split('T')[0]}.pdf`);
                                        }} className="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700">
                                            📥 {language === 'es' ? 'Descargar PDF' : 'Download PDF'}
                                        </button>
                                    </div>
                                    <div className="grid grid-cols-3 gap-4">
                                        <div className={`${darkMode ? 'bg-gray-700' : 'bg-blue-50'} p-4 rounded-lg`}>
                                            <p className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-600'} mb-2`}>{language === 'es' ? 'Promedio Sueño' : 'Avg Sleep'}</p>
                                            <p className="text-2xl font-bold text-blue-600">{(symptoms.reduce((a, s) => a + s.sleep, 0) / symptoms.length).toFixed(1)}/10</p>
                                        </div>
                                        <div className={`${darkMode ? 'bg-gray-700' : 'bg-pink-50'} p-4 rounded-lg`}>
                                            <p className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-600'} mb-2`}>{language === 'es' ? 'Promedio Energía' : 'Avg Energy'}</p>
                                            <p className="text-2xl font-bold text-pink-600">{(symptoms.reduce((a, s) => a + s.energy, 0) / symptoms.length).toFixed(1)}/10</p>
                                        </div>
                                        <div className={`${darkMode ? 'bg-gray-700' : 'bg-cyan-50'} p-4 rounded-lg`}>
                                            <p className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-600'} mb-2`}>{language === 'es' ? 'Promedio Ánimo' : 'Avg Mood'}</p>
                                            <p className="text-2xl font-bold text-cyan-600">{(symptoms.reduce((a, s) => a + s.mood, 0) / symptoms.length).toFixed(1)}/10</p>
                                        </div>
                                    </div>
                                </div>
                            </>
                        )}
                    </div>
                );
            };

            // PERÍODO
            const renderPeriod = () => {
                return (
                    <div className="pb-32 space-y-8" key={`period-${language}`}>
                        <h2 className="text-3xl font-light gradient-text">{t[language].period}</h2>
                        
                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg p-6 space-y-6`}>
                            <h3 className="font-semibold text-lg">{language === 'es' ? 'Registra tu período' : 'Record your period'}</h3>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-semibold mb-2">{language === 'es' ? 'Intensidad (1-10)' : 'Intensity (1-10)'}</label>
                                    <input type="range" min="1" max="10" value={periodForm.intensity} onChange={(e) => setPeriodForm({...periodForm, intensity: parseInt(e.target.value)})} className="w-full accent-pink-600"/>
                                    <p className="text-sm text-gray-600 dark:text-gray-400 mt-1">{periodForm.intensity}/10</p>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold mb-2">{language === 'es' ? 'Duración (días)' : 'Duration (days)'}</label>
                                    <input type="range" min="1" max="10" value={periodForm.duration} onChange={(e) => setPeriodForm({...periodForm, duration: parseInt(e.target.value)})} className="w-full accent-pink-600"/>
                                    <p className="text-sm text-gray-600 dark:text-gray-400 mt-1">{periodForm.duration} {language === 'es' ? 'días' : 'days'}</p>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold mb-2">{language === 'es' ? 'Síntomas' : 'Symptoms'}</label>
                                    <input type="text" placeholder={language === 'es' ? 'Ej: cólicos, hinchazón' : 'E.g: cramps, bloating'} value={periodForm.symptoms} onChange={(e) => setPeriodForm({...periodForm, symptoms: e.target.value})} className={`w-full px-4 py-2 border rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`}/>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold mb-2">{language === 'es' ? 'Fecha' : 'Date'}</label>
                                    <input type="date" value={periodForm.date} onChange={(e) => setPeriodForm({...periodForm, date: e.target.value})} className={`w-full px-4 py-2 border rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`}/>
                                </div>
                            </div>

                            <button onClick={() => {
                                setPeriodLog([...periodLog, periodForm]);
                                setPeriodForm({ intensity: 5, duration: 5, symptoms: '', date: new Date().toISOString().split('T')[0] });
                                alert(language === 'es' ? 'Período registrado ✓' : 'Period recorded ✓');
                            }} className="w-full bg-gradient-to-r from-pink-600 to-rose-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg">
                                {t[language].addRecord}
                            </button>
                        </div>

                        {periodLog.length > 0 && (
                            <>
                                <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg p-6`}>
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="font-semibold text-lg">📈 {language === 'es' ? 'Tendencia de Período' : 'Period Trend'}</h3>
                                        <button onClick={() => {
                                            const { jsPDF } = window.jspdf;
                                            const doc = new jsPDF();
                                            
                                            doc.setFontSize(20);
                                            doc.text('Lumera - Reporte de Período', 20, 20);
                                            
                                            doc.setFontSize(12);
                                            doc.text(`${language === 'es' ? 'Usuaria' : 'User'}: ${currentUser.profile_name}`, 20, 40);
                                            doc.text(`${language === 'es' ? 'Fecha' : 'Date'}: ${new Date().toLocaleDateString()}`, 20, 50);
                                            
                                            doc.setFontSize(14);
                                            doc.text(language === 'es' ? 'Resumen de Registros' : 'Records Summary', 20, 70);
                                            doc.setFontSize(11);
                                            
                                            const avgIntensity = (periodLog.reduce((a, p) => a + p.intensity, 0) / periodLog.length).toFixed(1);
                                            const avgDuration = (periodLog.reduce((a, p) => a + p.duration, 0) / periodLog.length).toFixed(1);
                                            
                                            doc.text(`${language === 'es' ? 'Intensidad promedio' : 'Avg intensity'}: ${avgIntensity}/10`, 20, 85);
                                            doc.text(`${language === 'es' ? 'Duración promedio' : 'Avg duration'}: ${avgDuration} días`, 20, 95);
                                            doc.text(`${language === 'es' ? 'Total de ciclos registrados' : 'Total cycles recorded'}: ${periodLog.length}`, 20, 105);
                                            
                                            doc.save(`Lumera_Periodo_${new Date().toISOString().split('T')[0]}.pdf`);
                                        }} className="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700">
                                            📥 {language === 'es' ? 'Descargar PDF' : 'Download PDF'}
                                        </button>
                                    </div>
                                    <canvas ref={chartRefPeriod} style={{maxHeight: '300px'}}></canvas>
                                </div>

                                <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg p-6`}>
                                    <h3 className="font-semibold text-lg mb-4">{language === 'es' ? 'Tu Historial' : 'Your History'}</h3>
                                    <div className="space-y-3">
                                        {periodLog.map((p, idx) => (
                                            <div key={idx} className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-4 rounded-lg`}>
                                                <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} mb-2`}>{p.date}</p>
                                                <p className="text-sm"><span className="font-semibold">{language === 'es' ? 'Intensidad' : 'Intensity'}:</span> {p.intensity}/10 | <span className="font-semibold">{language === 'es' ? 'Duración' : 'Duration'}:</span> {p.duration} días</p>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </>
                        )}
                    </div>
                );
            };

            // MITOS
            const renderMyths = () => {
                const { myths } = getMythsAndTips();
                
                return (
                    <div className="pb-32 space-y-6" key={`myths-${language}`}>
                        <h2 className="text-3xl font-light gradient-text">{t[language].myths}</h2>
                        
                        {myths && Array.isArray(myths) && myths.length > 0 ? myths.map((myth, idx) => (
                            <div key={idx} className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg overflow-hidden`}>
                                <div className="bg-red-50 dark:bg-red-900 border-l-4 border-red-600 p-6">
                                    <h3 className={`text-lg font-semibold ${darkMode ? 'text-red-300' : 'text-red-900'} mb-2`}>❌ {myth.myth}</h3>
                                </div>
                                
                                <div className="p-6 space-y-4">
                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-green-50'} border-l-4 border-green-600 p-4 rounded-lg`}>
                                        <p className={`font-semibold ${darkMode ? 'text-green-300' : 'text-green-900'} mb-2`}>✅ {myth.truth}</p>
                                    </div>

                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-blue-50'} border-l-4 border-blue-600 p-4 rounded-lg`}>
                                        <p className={`font-semibold mb-2 ${darkMode ? 'text-blue-300' : 'text-blue-900'}`}>🔬 {language === 'es' ? 'Base Científica' : 'Science'}</p>
                                        <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>{myth.science}</p>
                                    </div>

                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-purple-50'} border-l-4 border-purple-600 p-4 rounded-lg`}>
                                        <p className={`font-semibold mb-2 ${darkMode ? 'text-purple-300' : 'text-purple-900'}`}>💡 {language === 'es' ? 'Qué Hacer' : 'What to Do'}</p>
                                        <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>{myth.action}</p>
                                    </div>
                                </div>
                            </div>
                        )) : (
                            <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg p-6`}>
                                <p className="text-gray-600 dark:text-gray-400">{language === 'es' ? 'Cargando mitos...' : 'Loading myths...'}</p>
                            </div>
                        )}
                    </div>
                );
            };

            // CONSEJOS
            const renderTips = () => {
                const { tips } = getMythsAndTips();
                
                return (
                    <div className="pb-32 space-y-6" key={`tips-${language}`}>
                        <h2 className="text-3xl font-light gradient-text">{t[language].tips}</h2>
                        
                        {tips.map((tip, idx) => (
                            <div key={idx} className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg overflow-hidden`}>
                                <div className="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-6">
                                    <h3 className="text-2xl font-semibold">{tip.emoji} {tip.title}</h3>
                                </div>

                                <div className="p-6 space-y-4">
                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-yellow-50'} border-l-4 border-yellow-500 p-4 rounded-lg`}>
                                        <p className={`font-semibold mb-2 ${darkMode ? 'text-yellow-300' : 'text-yellow-900'}`}>💡 {language === 'es' ? 'Por qué es importante' : 'Why it matters'}</p>
                                        <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>{tip.why}</p>
                                    </div>

                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-green-50'} border-l-4 border-green-600 p-4 rounded-lg`}>
                                        <p className={`font-semibold mb-2 ${darkMode ? 'text-green-300' : 'text-green-900'}`}>✅ {language === 'es' ? 'Cómo hacerlo' : 'How to do it'}</p>
                                        <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'} whitespace-pre-line`}>{tip.how}</p>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                );
            };

            // TALLERES
            const renderWorkshops = () => {
                return (
                    <div className="pb-32 space-y-6" key={`workshops-${language}`}>
                        <h2 className="text-3xl font-light gradient-text">{t[language].workshops}</h2>
                        <div className="grid md:grid-cols-2 gap-6">
                            {[
                                { title: language === 'es' ? 'Nutrición sin Culpa' : 'Nutrition Without Guilt', date: '15 Dic', type: 'webinar' },
                                { title: language === 'es' ? 'Ejercicio que Empodera' : 'Empowering Exercise', date: '20 Dic', type: 'workshop' }
                            ].map((w, idx) => (
                                <div key={idx} className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg p-6`}>
                                    <h3 className="text-xl font-semibold mb-4">{w.title}</h3>
                                    <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} mb-4`}>📅 {w.date}</p>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            // COMUNIDAD
            const renderCommunity = () => {
                return (
                    <div className="pb-32 space-y-8" key={`community-${language}`}>
                        <h2 className="text-3xl font-light gradient-text">{t[language].community}</h2>
                        
                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg p-6`}>
                            <h3 className="font-semibold text-lg mb-4">{language === 'es' ? '💜 Comparte tu Historia' : '💜 Share Your Story'}</h3>
                            <textarea value={communityMessage} onChange={(e) => setCommunityMessage(e.target.value)} placeholder={language === 'es' ? 'Cuéntanos cómo te sientes...' : 'Tell us how you feel...'} className={`w-full px-4 py-3 border rounded-lg mb-4 resize-none ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`} rows="4"/>
                            <button onClick={() => {
                                if (communityMessage.trim()) {
                                    setUserMessages([...userMessages, { name: currentUser.profile_name, story: communityMessage, date: new Date().toLocaleDateString() }]);
                                    setCommunityMessage('');
                                    alert(language === 'es' ? '¡Mensaje compartido! 💜' : 'Message shared! 💜');
                                }
                            }} className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg">
                                {language === 'es' ? 'Compartir Mensaje' : 'Share Message'}
                            </button>
                        </div>

                        {userMessages.length > 0 && (
                            <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg p-6`}>
                                <h3 className="font-semibold text-lg mb-6">{language === 'es' ? 'Historias de Nuestra Comunidad' : 'Community Stories'}</h3>
                                <div className="grid md:grid-cols-2 gap-6">
                                    {userMessages.map((msg, idx) => (
                                        <div key={idx} className={`${darkMode ? 'bg-gray-700' : 'bg-purple-50'} rounded-xl p-6 border-l-4 border-purple-600`}>
                                            <h4 className="font-semibold mb-2">👩 {msg.name}</h4>
                                            <p className={`italic ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-3`}>"{msg.story}"</p>
                                            <p className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>📅 {msg.date}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // RENDERIZAR CONTENIDO
            const renderContent = () => {
                if (!currentUser) return null;
                
                // Páginas premium que requieren suscripción
                const premiumPages = ['workshops', 'community']; // nutrition y exercise tienen freemium interno
                
                if (premiumPages.includes(currentPage) && !isPremium()) {
                    return (
                        <div className="text-center py-20">
                            <div className="mb-6">
                                <div className="inline-block p-8 bg-gradient-to-br from-purple-100 to-pink-100 rounded-full mb-6">
                                    <svg className="w-24 h-24 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                    </svg>
                                </div>
                            </div>
                            <h2 className="text-3xl font-bold mb-4 gradient-text">{language === 'es' ? 'Contenido Premium' : 'Premium Content'}</h2>
                            <p className="text-xl text-gray-600 mb-8 max-w-md mx-auto">
                                {language === 'es' ? 'Desbloquea todas las funcionalidades de Lumera' : 'Unlock all Lumera features'}
                            </p>
                            <div className="max-w-md mx-auto bg-white rounded-2xl shadow-xl p-8 mb-6">
                                <div className="mb-6">
                                    <div className="text-5xl font-bold gradient-text mb-2">{PRICES[getRegion()].price}</div>
                                    <div className="text-sm text-gray-600">{language === 'es' ? 'por mes' : 'per month'}</div>
                                </div>
                                <ul className="text-left space-y-3 mb-8">
                                    <li className="flex items-start">
                                        <svg className="w-6 h-6 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                        </svg>
                                        <span>{language === 'es' ? 'Menús personalizados semanales' : 'Personalized weekly menus'}</span>
                                    </li>
                                    <li className="flex items-start">
                                        <svg className="w-6 h-6 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                        </svg>
                                        <span>{language === 'es' ? 'Rutinas de ejercicio adaptadas' : 'Adapted exercise routines'}</span>
                                    </li>
                                    <li className="flex items-start">
                                        <svg className="w-6 h-6 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                        </svg>
                                        <span>{language === 'es' ? 'Seguimiento de síntomas y análisis' : 'Symptom tracking and analysis'}</span>
                                    </li>
                                </ul>
                                <button onClick={handleSubscribe} className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-lg font-semibold text-lg hover:shadow-lg">
                                    💎 {language === 'es' ? 'Suscribirme' : 'Subscribe'}
                                </button>
                            </div>
                        </div>
                    );
                }
                
                switch(currentPage) {
                    case 'home': return renderHome();
                    case 'nutrition': return renderNutrition();
                    case 'exercise': return renderExercise();
                    case 'symptoms': return renderSymptoms();
                    case 'period': return renderPeriod();
                    case 'myths': return renderMyths();
                    case 'tips': return renderTips();
                    case 'workshops': return renderWorkshops();
                    case 'community': return renderCommunity();
                    default: return renderHome();
                }
            };

            if (loading) return <div className="min-h-screen bg-gradient-to-br from-purple-100 to-pink-50 flex items-center justify-center"><h1 className="text-4xl gradient-text">Lumera</h1></div>;
            
            // DEBUG: Ver estado actual
            console.log('RENDER STATE:', { showAuth, showQuiz, session: !!session, currentUser: !!currentUser });
            
            if (showAuth) return (
                <div className="min-h-screen bg-gradient-to-br from-purple-100 to-pink-50 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-2xl p-12 max-w-md w-full">
                        <h1 className="text-4xl font-light gradient-text mb-8 text-center">Lumera</h1>
                        <div className="flex gap-2 mb-6">
                            <button onClick={() => setAuthMode('login')} className={`flex-1 py-2 rounded-lg font-semibold ${authMode === 'login' ? 'bg-purple-600 text-white' : 'bg-gray-200'}`}>{language === 'es' ? 'Iniciar Sesión' : 'Login'}</button>
                            <button onClick={() => setAuthMode('register')} className={`flex-1 py-2 rounded-lg font-semibold ${authMode === 'register' ? 'bg-purple-600 text-white' : 'bg-gray-200'}`}>{language === 'es' ? 'Registrarse' : 'Register'}</button>
                        </div>
                        <div className="space-y-4 mb-6">
                            <input type="email" placeholder="Email" value={authData.email} onChange={(e) => setAuthData({...authData, email: e.target.value})} className="w-full px-4 py-3 border rounded-lg"/>
                            <input type="password" placeholder="Password" value={authData.password} onChange={(e) => setAuthData({...authData, password: e.target.value})} className="w-full px-4 py-3 border rounded-lg"/>
                        </div>
                        
                        {authMode === 'register' && (
                            <div className="mb-6 space-y-3 text-xs bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                <p className="font-bold text-sm text-purple-900 mb-3">
                                    {language === 'es' ? '⚠️ Información Legal Importante' : '⚠️ Important Legal Information'}
                                </p>
                                
                                {/* CHECKBOX 1: Edad */}
                                <label className="flex items-start gap-2 cursor-pointer">
                                    <input type="checkbox" required className="mt-1"/>
                                    <span className="text-gray-800">
                                        {language === 'es' 
                                            ? 'Confirmo que soy mayor de 18 años.' 
                                            : 'I confirm I am over 18 years old.'}
                                    </span>
                                </label>
                                
                                {/* CHECKBOX 2: Disclaimer Médico con desplegable */}
                                <div className="border-l-2 border-purple-400 pl-3">
                                    <label className="flex items-start gap-2 cursor-pointer">
                                        <input type="checkbox" required className="mt-1"/>
                                        <div>
                                            <span className="text-gray-800 font-medium">
                                                {language === 'es' 
                                                    ? 'Entiendo que Lumera es una herramienta de bienestar y NO sustituye consejo médico profesional.' 
                                                    : 'I understand that Lumera is a wellness tool and does NOT replace professional medical advice.'}
                                            </span>
                                            <details className="mt-2 text-gray-600">
                                                <summary className="cursor-pointer text-purple-600 hover:text-purple-800">
                                                    {language === 'es' ? '📖 Leer más sobre nuestro disclaimer médico' : '📖 Read more about our medical disclaimer'}
                                                </summary>
                                                <div className="mt-2 p-3 bg-white rounded text-xs leading-relaxed">
                                                    {language === 'es' ? (
                                                        <>
                                                            <p className="mb-2"><strong>Lumera NO es un servicio médico.</strong></p>
                                                            <p className="mb-2">• No diagnosticamos condiciones de salud</p>
                                                            <p className="mb-2">• No prescribimos tratamientos</p>
                                                            <p className="mb-2">• No sustituimos la opinión de tu médico</p>
                                                            <p className="mb-2">• Proporcionamos información general de bienestar basada en ciencia</p>
                                                            <p className="mt-3 font-semibold">Siempre consulta con un profesional de salud antes de hacer cambios significativos en tu dieta o rutina de ejercicio.</p>
                                                        </>
                                                    ) : (
                                                        <>
                                                            <p className="mb-2"><strong>Lumera is NOT a medical service.</strong></p>
                                                            <p className="mb-2">• We do not diagnose health conditions</p>
                                                            <p className="mb-2">• We do not prescribe treatments</p>
                                                            <p className="mb-2">• We do not replace your doctor's opinion</p>
                                                            <p className="mb-2">• We provide general wellness information based on science</p>
                                                            <p className="mt-3 font-semibold">Always consult with a health professional before making significant changes to your diet or exercise routine.</p>
                                                        </>
                                                    )}
                                                </div>
                                            </details>
                                        </div>
                                    </label>
                                </div>
                                
                                {/* CHECKBOX 3: Privacidad con desplegable */}
                                <div className="border-l-2 border-blue-400 pl-3">
                                    <label className="flex items-start gap-2 cursor-pointer">
                                        <input type="checkbox" required className="mt-1"/>
                                        <div>
                                            <span className="text-gray-800 font-medium">
                                                {language === 'es' 
                                                    ? 'Acepto la Política de Privacidad y el tratamiento seguro de mis datos de salud.' 
                                                    : 'I accept the Privacy Policy and secure handling of my health data.'}
                                            </span>
                                            <details className="mt-2 text-gray-600">
                                                <summary className="cursor-pointer text-blue-600 hover:text-blue-800">
                                                    {language === 'es' ? '🔒 Cómo protegemos tus datos' : '🔒 How we protect your data'}
                                                </summary>
                                                <div className="mt-2 p-3 bg-white rounded text-xs leading-relaxed">
                                                    {language === 'es' ? (
                                                        <>
                                                            <p className="mb-2"><strong>Tu privacidad es nuestra prioridad:</strong></p>
                                                            <p className="mb-2">✅ <strong>Encriptación:</strong> Todos tus datos están cifrados</p>
                                                            <p className="mb-2">✅ <strong>Confidencialidad:</strong> Solo tú accedes a tu información</p>
                                                            <p className="mb-2">✅ <strong>NO vendemos datos:</strong> Nunca compartimos tu información con terceros</p>
                                                            <p className="mb-2">✅ <strong>Anonimización:</strong> Datos estadísticos agregados sin identificación personal</p>
                                                            <p className="mb-2">✅ <strong>Derecho de eliminación:</strong> Puedes borrar tu cuenta en cualquier momento</p>
                                                            <p className="mt-3">📧 Dudas: <a href="mailto:privacy@lumera.app" className="text-blue-600 underline">privacy@lumera.app</a></p>
                                                        </>
                                                    ) : (
                                                        <>
                                                            <p className="mb-2"><strong>Your privacy is our priority:</strong></p>
                                                            <p className="mb-2">✅ <strong>Encryption:</strong> All your data is encrypted</p>
                                                            <p className="mb-2">✅ <strong>Confidentiality:</strong> Only you access your information</p>
                                                            <p className="mb-2">✅ <strong>We DON'T sell data:</strong> We never share your info with third parties</p>
                                                            <p className="mb-2">✅ <strong>Anonymization:</strong> Aggregated stats without personal identification</p>
                                                            <p className="mb-2">✅ <strong>Right to deletion:</strong> You can delete your account anytime</p>
                                                            <p className="mt-3">📧 Questions: <a href="mailto:privacy@lumera.app" className="text-blue-600 underline">privacy@lumera.app</a></p>
                                                        </>
                                                    )}
                                                </div>
                                            </details>
                                        </div>
                                    </label>
                                </div>
                                
                                {/* CHECKBOX 4: Propiedad Intelectual */}
                                <div className="border-l-2 border-pink-400 pl-3">
                                    <label className="flex items-start gap-2 cursor-pointer">
                                        <input type="checkbox" required className="mt-1"/>
                                        <div>
                                            <span className="text-gray-800 font-medium">
                                                {language === 'es' 
                                                    ? 'Acepto los Términos de Uso y respeto la propiedad intelectual de Lumera.' 
                                                    : 'I accept the Terms of Use and respect Lumera\'s intellectual property.'}
                                            </span>
                                            <details className="mt-2 text-gray-600">
                                                <summary className="cursor-pointer text-pink-600 hover:text-pink-800">
                                                    {language === 'es' ? '© Derechos de autor' : '© Copyright'}
                                                </summary>
                                                <div className="mt-2 p-3 bg-white rounded text-xs leading-relaxed">
                                                    {language === 'es' ? (
                                                        <>
                                                            <p className="mb-2"><strong>© 2025 Lumera. Todos los derechos reservados.</strong></p>
                                                            <p className="mb-2">Todo el contenido de esta aplicación está protegido:</p>
                                                            <p className="mb-2">• Recetas y planes nutricionales</p>
                                                            <p className="mb-2">• Rutinas de ejercicio</p>
                                                            <p className="mb-2">• Textos, diseño y código</p>
                                                            <p className="mb-2">• Algoritmos y fórmulas de cálculo</p>
                                                            <p className="mt-3 font-semibold text-red-700">Queda prohibida la reproducción, distribución o uso comercial sin autorización escrita.</p>
                                                        </>
                                                    ) : (
                                                        <>
                                                            <p className="mb-2"><strong>© 2025 Lumera. All rights reserved.</strong></p>
                                                            <p className="mb-2">All content in this application is protected:</p>
                                                            <p className="mb-2">• Recipes and nutrition plans</p>
                                                            <p className="mb-2">• Exercise routines</p>
                                                            <p className="mb-2">• Texts, design and code</p>
                                                            <p className="mb-2">• Algorithms and calculation formulas</p>
                                                            <p className="mt-3 font-semibold text-red-700">Reproduction, distribution or commercial use without written authorization is prohibited.</p>
                                                        </>
                                                    )}
                                                </div>
                                            </details>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        )}
                        
                        <button onClick={authMode === 'login' ? handleLogin : handleRegister} className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-semibold">{authMode === 'login' ? 'Entrar' : 'Crear Cuenta'}</button>
                        <button onClick={() => setLanguage(language === 'es' ? 'en' : 'es')} className="w-full mt-4 text-sm text-gray-600">{language === 'es' ? '🇬🇧 English' : '🇪🇸 Español'}</button>
                    </div>
                </div>
            );
            
            // IMPORTANTE: Solo mostrar quiz si hay sesión válida
            if (showQuiz && session) return renderQuiz();
            
            // Si showQuiz es true pero no hay sesión, forzar auth
            if (showQuiz && !session) {
                setShowQuiz(false);
                setShowAuth(true);
                return null;
            }

            return (
                <div className={darkMode ? 'bg-gray-900 text-white' : 'bg-gray-50'}>
                    <header className={`${darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'} shadow sticky top-0 z-40 border-b`}>
                        <div className="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <svg width="32" height="32" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                                    <defs>
                                        <linearGradient id="flameGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                            <stop offset="0%" style={{stopColor:'#d4af7f',stopOpacity:1}} />
                                            <stop offset="100%" style={{stopColor:'#e8c89f',stopOpacity:1}} />
                                        </linearGradient>
                                    </defs>
                                    <path d="M 32 12 A 20 20 0 0 0 32 52 A 16 16 0 0 1 32 16 Z" fill="#b8a8d8"/>
                                    <path d="M 40 32 Q 40 26 42 22 Q 42 28 40 35 Q 38 28 38 22 Q 40 26 40 32" fill="url(#flameGrad)"/>
                                </svg>
                                <h1 className="text-2xl font-light gradient-text">Lumera</h1>
                            </div>
                            <div className="flex items-center gap-3">
                                <select value={language} onChange={(e) => setLanguage(e.target.value)} className={`px-3 py-2 rounded text-sm border ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-gray-100 border-gray-300'}`}>
                                    <option value="es">🇪🇸</option>
                                    <option value="en">🇬🇧</option>
                                </select>
                                <button onClick={() => setDarkMode(!darkMode)} className={`px-3 py-2 rounded text-sm ${darkMode ? 'bg-yellow-500 text-black' : 'bg-gray-200'}`}>
                                    {darkMode ? '☀️' : '🌙'}
                                </button>
                                {!isPremium() && <button onClick={handleSubscribe} className="px-4 py-2 rounded text-sm font-semibold bg-gradient-to-r from-purple-600 to-pink-600 text-white">💎 Premium</button>}
                                <button onClick={handleLogout} className="text-sm text-gray-600 dark:text-gray-400">{language === 'es' ? 'Salir' : 'Exit'}</button>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-6xl mx-auto px-4 py-8" key={`content-${currentPage}-${language}`}>
                        {renderContent()}
                    </main>

                    {/* Footer con disclaimer y enlaces legales */}
                    <footer className={`${darkMode ? 'bg-gray-800 border-gray-700' : 'bg-gray-50 border-gray-200'} border-t py-6 mb-20`}>
                        <div className="max-w-6xl mx-auto px-4">
                            <div className="text-center mb-4">
                                <p className="text-xs text-gray-600 dark:text-gray-400 mb-2">
                                    {language === 'es'
                                        ? '⚠️ Lumera es una herramienta de bienestar, no sustituye consejo médico profesional.'
                                        : '⚠️ Lumera is a wellness tool, not a substitute for professional medical advice.'}
                                </p>
                                <div className="flex justify-center gap-4 text-xs">
                                    <a href="mailto:support@lumera.app" className="text-purple-600 hover:underline">
                                        {language === 'es' ? 'Soporte' : 'Support'}
                                    </a>
                                    <a href="mailto:privacy@lumera.app" className="text-purple-600 hover:underline">
                                        {language === 'es' ? 'Privacidad' : 'Privacy'}
                                    </a>
                                    <a href="mailto:hello@lumera.app" className="text-purple-600 hover:underline">
                                        {language === 'es' ? 'Contacto' : 'Contact'}
                                    </a>
                                </div>
                            </div>
                            <p className="text-xs text-center text-gray-500">
                                © 2025 Lumera. {language === 'es' ? 'Todos los derechos reservados.' : 'All rights reserved.'}
                            </p>
                        </div>
                    </footer>

                    <nav className={`fixed bottom-0 left-0 right-0 ${darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'} border-t shadow-lg`}>
                        <div className="max-w-6xl mx-auto flex justify-around overflow-x-auto">
                            {[
                                { page: 'home', label: t[language].home, emoji: '📊', premium: false },
                                { page: 'nutrition', label: t[language].nutrition, emoji: '🥗', premium: true },
                                { page: 'exercise', label: t[language].exercise, emoji: '💪', premium: true },
                                { page: 'symptoms', label: t[language].symptoms, emoji: '📝', premium: true },
                                { page: 'period', label: t[language].period, emoji: '📅', premium: true },
                                { page: 'myths', label: t[language].myths, emoji: '❌', premium: false },
                                { page: 'tips', label: t[language].tips, emoji: '✨', premium: false },
                                { page: 'community', label: t[language].community, emoji: '💜', premium: true }
                            ].map((item) => (
                                <button key={item.page} onClick={() => setCurrentPage(item.page)}
                                    className={`py-4 px-3 text-xs sm:text-sm border-t-4 transition whitespace-nowrap ${
                                        currentPage === item.page
                                            ? `border-purple-600 ${darkMode ? 'bg-gray-700' : 'bg-purple-50'} text-purple-600`
                                            : `${darkMode ? 'border-gray-700 text-gray-400' : 'border-gray-200 text-gray-600'}`
                                    }`}>
                                    <div>{item.emoji}{item.premium && !isPremium() && ' 🔒'}</div>
                                    <div className="hidden sm:block text-xs">{item.label}</div>
                                </button>
                            ))}
                        </div>
                    </nav>

                    {/* BOTÓN FLOTANTE LUMI */}
                    {currentUser && (
                        <button
                            onClick={() => setShowLumiChat(true)}
                            className="fixed bottom-24 right-6 z-50 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-full p-4 shadow-2xl hover:scale-110 transition transform"
                            title={language === 'es' ? 'Habla con Lumi' : 'Talk to Lumi'}>
                            <svg className="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                            </svg>
                        </button>
                    )}

                    {/* MODAL CHAT LUMI */}
                    {showLumiChat && (
                        <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4" onClick={() => setShowLumiChat(false)}>
                            <div 
                                className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-t-3xl sm:rounded-3xl shadow-2xl w-full sm:w-96 h-[80vh] sm:h-[600px] flex flex-col`}
                                onClick={(e) => e.stopPropagation()}>
                                
                                {/* Header */}
                                <div className="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-4 rounded-t-3xl flex justify-between items-center">
                                    <div className="flex items-center gap-3">
                                        <svg className="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                        </svg>
                                        <div>
                                            <h3 className="font-semibold text-lg">Lumi</h3>
                                            <p className="text-xs opacity-90">
                                                {!isPremium() && `${dailyQuestions}/3 ${language === 'es' ? 'preguntas hoy' : 'questions today'}`}
                                            </p>
                                        </div>
                                    </div>
                                    <button onClick={() => setShowLumiChat(false)} className="text-white hover:bg-white/20 rounded-full p-2">
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/>
                                        </svg>
                                    </button>
                                </div>

                                {/* Messages */}
                                <div className="flex-1 overflow-y-auto p-4 space-y-4">
                                    {lumiMessages.length === 0 && (
                                        <div className="text-center py-12">
                                            <svg className="w-16 h-16 mx-auto mb-4 text-purple-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                            </svg>
                                            <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} mb-2`}>
                                                {language === 'es' ? '¡Hola! Soy Lumi 💜' : 'Hi! I\'m Lumi 💜'}
                                            </p>
                                            <p className={`text-xs ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>
                                                {language === 'es' 
                                                    ? 'Pregúntame lo que quieras sobre nutrición, ejercicio o cómo te sientes.'
                                                    : 'Ask me anything about nutrition, exercise or how you feel.'}
                                            </p>
                                        </div>
                                    )}
                                    
                                    {lumiMessages.map((msg, i) => (
                                        <div key={i} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                            <div className={`max-w-[80%] rounded-2xl px-4 py-2 ${
                                                msg.role === 'user'
                                                    ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white'
                                                    : darkMode ? 'bg-gray-700 text-white' : 'bg-gray-100 text-gray-900'
                                            }`}>
                                                <p className="text-sm leading-relaxed">{msg.content}</p>
                                            </div>
                                        </div>
                                    ))}
                                    
                                    {lumiLoading && (
                                        <div className="flex justify-start">
                                            <div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-100'} rounded-2xl px-4 py-2`}>
                                                <div className="flex gap-1">
                                                    <div className="w-2 h-2 bg-purple-600 rounded-full animate-bounce" style={{animationDelay: '0ms'}}></div>
                                                    <div className="w-2 h-2 bg-purple-600 rounded-full animate-bounce" style={{animationDelay: '150ms'}}></div>
                                                    <div className="w-2 h-2 bg-purple-600 rounded-full animate-bounce" style={{animationDelay: '300ms'}}></div>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Input */}
                                <div className="border-t p-4">
                                    <div className="flex gap-2">
                                        <input
                                            type="text"
                                            value={lumiInput}
                                            onChange={(e) => setLumiInput(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && sendToLumi()}
                                            placeholder={language === 'es' ? 'Escribe tu pregunta...' : 'Type your question...'}
                                            className={`flex-1 px-4 py-3 rounded-full border ${
                                                darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-gray-50 border-gray-300'
                                            } focus:outline-none focus:ring-2 focus:ring-purple-600`}
                                            disabled={lumiLoading}
                                        />
                                        <button
                                            onClick={sendToLumi}
                                            disabled={!lumiInput.trim() || lumiLoading}
                                            className="bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-full p-3 disabled:opacity-50 hover:scale-105 transition">
                                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<LumeraApp />);
    </script>
</body>
</html>
